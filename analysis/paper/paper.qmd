---
title: "From Stone to Tool: How Raw Materials Influenced Upper Paleolithic Technology in Southwestern Iberia (Vale Boi)"
author:
  - Joana Belmiro:
      correspondence: "yes"
      email: jfbelmiro@ualg.pt
      orcid: 0000-0003-1689-0557
      institute:
        - ICArEHB
  - Nuno Bicho:
      institute: ICArEHB
      orcid: 0000-0003-1689-0558
  - Xavier Terradas:
      institute: CSIC
      orcid: 0000-0003-1689-0559
  - João Cascalheira:
      orcid: 0000-0003-1689-0551
      institute: ICArEHB
institute:
  - ICArEHB:
      name: Interdisciplinary Center for Archaeology and Human Evolution
      address: 
  - CSIC: CSIC
title-block-published: "Last updated"  
date: now
date-format: long
format: 
  docx:
    reference-doc: "../templates/template.docx" # Insert path for the DOCX file
execute:
  echo: false
  warning: false
  message: false
  comment: "#>"
  fig-path: "../figures/"
  fig-dpi: 600
filters:
  - ../templates/scholarly-metadata.lua
  - ../templates/author-info-blocks.lua
  - ../templates/pagebreak.lua
bibliography: references.bib
csl: "../templates/journal-of-archaeological-science.csl" # Insert path for the bib-style
abstract: |
  Text of abstract
keywords: |
  keyword 1; keyword 2; keyword 3
highlights: |
  These are the highlights. 
---

<!-- This is the format for text comments that will be ignored during renderings. Do not put R code in these comments because it will not be ignored. -->

<!-- With the following code you can access and display values from the yml header above. -->

Keywords: `r rmarkdown::metadata$keywords`

Highlights: `r rmarkdown::metadata$highlights`

<!-- The actual document text starts here: -->

```{r}
#| label: library

# Read libraries necessary for running the script
library(readr)
library(dplyr)
library(tidyr)
library(stringr)
library(ggplot2)
library(janitor)
library(ggpubr)
library(knitr)
library(tibble)

```

# Introduction

The Iberian Peninsula has been a key region for the study of human adaptations and cultural transitions in Archaeology. Located in the westernmost tip of Europe and with a generally stable climate even during the coldest periods punctuating the Late Pleistocene, this region has yielded some of the most significant glacial refugia in Europe [@hewitt2000; @gómez2007; @gonzález-sampériz2010; @carvalho2022], and has been considered a long-term eco-cultural refugia [@cascalheira2017].

For this reason, the Iberian Peninsula has been the focal point of several discussions regarding Late Pleistocene human adaptations [@finlayson2006; @zilhão2017; @cascalheira2017].

A particularly good example is the region’s role in the discussion of Upper Paleolithic technocomplexes transitions. This has been possible due to the existence of several ecological niches, consistently used through time, possibly due to the stability in the richness and variety of resources in Iberia. This continuous use would then create long-term regional adaptive structures, which when correlated with the ecological niches, have been referred to as eco-cultural niches [@cascalheira2017]. These eco-cultural niches—which yielded multi-layered sites—. provide an exceptional opportunity to understand long-term dynamics regarding biotic and abiotic resource exploitation since they can provide details on how human populations maintained or changed their adaptive systems when facing cultural and social transformations.

More specifically, southwestern Iberia has been shown to be a key eco-cultural niche to study cultural transitions and the role of such a peripheral coastal region within hunter-gatherer social networks [@cascalheira2017]. This has been mostly due to the archaeological site of Vale Boi, located in southwesternmost Iberia and characterized by a nearly complete UP sequence (++). This site is crucial for understanding Upper Paleolithic (UP) adaptations, as it is currently the only site in southwestern Iberia with a long-term occupation spanning most of the UP, enabling the exploration of cultural and technological trends over time (Cascalheira et al. 2017).

For example, Vale Boi has provided valuable insights into hunter-gatherer subsistence strategies and technological organisation (Belmiro et al. 2021; Bicho et al. 2013; Cascalheira et al. 2017; Cascalheira 2019; Horta et al. 2019; Manne et al. 2012; Marreiros et al. 2016), contributing to a better understanding of territory exploitation and interactions with other regions of Iberia throughout the UP. Especially due to lithic technology studies from this site, the region has been shown to have played a shifting and complex role within the larger territory.

During the Gravettian, the peripheral nature of the region studies of Gravettian occupations reveal marked regional differences, suggesting more limited movement of people and information in southwestern Iberia (Marreiros and Bicho, 2013). In comparison, Proto-Solutrean evidence indicates technological similarities and close contact with central Portugal (Belmiro et al., 2021). The Solutrean period stands out as a particularly dynamic phase at Vale Boi, during which the site served as a key connection point between central Portugal and southern Spain, facilitating social networks and cultural exchanges (Cascalheira, 2013; Cascalheira et al., 2017).

Expanding on these findings, recent research has further refined our understanding of mobility and social networks through lithic raw material studies at the site. Our team’s recent work (Belmiro et al., 2025) identified non-local cherts originating from central Portugal (\>250 km from Vale Boi) and southern Spain (\>200 km from Vale Boi). The proportions of these materials varied across the UP, with earlier occupations (Gravettian) showing high frequencies of non-local chert, while later ones (Proto-Solutrean and Solutrean) exhibited a marked decline. These findings suggest the establishment and maintenance of extensive social networks connecting southwestern Portugal to Southern spain and central Portugal as early as the beginning of the UP.

These results, particularly those related to the Gravettian, were interpreted as outcomes of residential mobility rather than direct social network influences, though further investigation is required.

Despite the insights gained from previous studies, the relationship between lithic technology and raw material use at Vale Boi remains largely uncorrelated. While broader research highlights the complexity of lithic technological organisation, a more integrated approach is needed to fully understand how raw material provisioning influenced technological strategies at the site and what this can tell us about how hunter-gatherer groups organized, explored the territory and connected to others across Iberia. To address this, our goal is to combine lithic technological and chert raw material studies to better characterize hunter-gatherer technological and social adaptations throughout the UP in southwestern Iberia. To do so, we create and test expectations built upon previous archaeological and ethnographic studies of the technological organization of hunter-gatherers.

## Theoretical framework and objectives

Lithic technological organisation has long been a central focus in archaeology for the insights it offers into past human behaviour and lifeways. Nelson (1991) defines lithic technological organisation as the selection and integration of strategies for the production, use, transportation, discarding, and management of tools and raw materials. Kelly (1988) describes it as the interplay of space and time in lithic tool production within a cultural system. This includes activities such as raw material sourcing and distribution, tool manufacture, use, reuse, and discard, as well as broader behavioural patterns like mobility and settlement systems. Together, these definitions underscore the multifaceted nature of lithic technological organisation and its utility in examining key aspects of hunter-gatherer adaptations over time.

Raw material procurement is a key aspect of lithic technological organisation, as it played a crucial role in the lives of past hunter-gatherer groups by determing the possibilities for tool production and use (Bamforth & Bleed, 1997). Approaches focused on the study of raw materials provide key knowledge on several topics of hunter-gatherer organisation such as procurement and mobility strategies (Ambrose, 1990; Binford, 1979, 1985; Gould, 1985; Kuhn, 1991; Mccall, 2007), occupation types and their duration (Kuhn, 2004; Surovell, 2009; Grove, 2023), and social networks and exchanges (Whallon, 2006; Gamble, 1999). These approaches focus on the characterisation of geological and archaeological raw materials to identify local and non-local raw materials within an assemblage, their possible sources, and examine their proportions within a site over different occupations and periods.

While distance to source and raw material proportions offer valuable insights, they represent only one aspect of raw material procurement and management. A raw material-focused approach alone is insufficient for comprehensively understanding mobility patterns and technological organisation. Indeed, numerous studies and models from both ethnographic and archaeological perspectives have demonstrated the complex interplay between lithic technological variability, raw material provisioning, and mobility.

For example, technological variability within a lithic assemblage may be explained by the abundance and quality of raw materials (Andrefsky, 1994; Brown, 1999; Oestmo, 2017). Whenever raw materials in proximity to a residential site are abundant and of good quality, a high percentage of formal tools are produced (Andrefsky, 1994; Perlès, 1992), and artefacts show less reduction intensity and decreased conversation through retouch (Thacker, 2002). Whenever local raw materials are scarce or of low quality, non-local resources are procured to produce mostly formal tools (Andrefsky, 1994; Perlès, 1992). Similarly, when groups move to areas where raw material is scarcer or of poorer quality, more effort is placed into the preparation of transportable cores and the production of tools (Kelly, 1988).

However, the different patterns between local and non-local raw material proportion and use in lithic assemblages may be less obvious whenever prehistoric groups have easy access to non-local raw materials due to high mobility or exchanges between groups (Akerman et al., 2002; Torrence, 1996; Brown, 1999; Oestmo). Furthermore, Roth and Dibble (1998) demonstrate that even in areas where good quality raw material is abundant, non-local raw materials were still transported to the site, often in the form of large blanks or trimmed cores, and both local and non-local raw materials were retouched into tools.

Tools, flakes and cores often functioned as portable sources of raw material within mobile toolkits or during non-local raw material procurement, enabling stone knapping during periods of limited time or in environments with scarce or unsuitable materials (Kelly, 1988; Morrow, 1996; Gould et al., 1971; Kuhn, 1994; Perlès, 1992; Shott, 1986). For example, the transport of formal cores (e.g., blade cores) and bifaces used as cores have been interpreted as lightweight and reconfigurable raw material storage strategies (Clark, 1987; Kelly, 1988). Formal tools and the degree of tool maintenance have also been associated with planned preparation, efficient use, and transportability, reflecting their connection to mobile settlement strategies, short-term site occupations (Torrence, 1983) and the regional distribution of raw materials (Bamforth, 1986). For example, non-local raw materials, transported as part of personal toolkits (frequently associated with residential mobility), would primarily arrive at sites as retouched pieces (Kuhn, 2004). These artefacts would show higher degrees of reduction and reworking (Kuhn, 2004) and a higher percentage of non-cortical flakes (Roth and Dibble 1998), as they would have been in use for an extended period before being discarded. When knapped on-site, non-local materials also tend to exhibit higher proportions of retouched tools compared to local materials. Tool variability and size are also impacted by mobility and uncertainty regarding raw material availability; increased group mobility may create a pattern of limited tool variability, and tools may become less specialised and easily reconfigurable, such as retouched blanks (Shott, 1986; Odell, 1981; Siegel, 1984). Increased mobility also often results in smaller tools (Shott, 1986), although other authors have noted that large tools may be well-suited to a mobile lifestyle due to their extended use-life, allowing them to remain functional in areas where raw materials are scarce or unsuitable for knapping (Morrow, 1996).

The proportions of local vs non-local raw materials discussed thus far have focused greatly on group mobility, which is linked with residential mobility and occupation duration. Residential mobility (e.g., foraging range size and frequency of residential moves) is a defining characteristic of hunter-gatherer societies and plays a central role in their lifeways (Kelly, 1995). It is a key factor driving changes in lithic assemblages (Brown, 1999; Oestmo, 2017; Roth & Dibble, 1998) as it significantly impacts the cost and use of artefacts and raw materials since they affect the relation between the distance of raw material sources to sites (Kuhn, 2004). As such, different raw material and technological patterns have been observed between short-term and long-term occupations.

Short-term occupations typically rely on transported (non-local) toolkits (Torrence, 1983) and raw materials (Surovell, 2009), show higher reduction intensity, and an increased tools-to-debitage ratio in the assemblages (Grove et al., 2023). Long-term occupations, typically rely on provisioning sites with locally available and suitable raw materials, while non-local materials are gradually used and discarded (Grove et al., 2023; Surovell, 2009). Non-local raw material cores are highly reduced and extensively exploited (Kuhn, 2004; Roth & Dibble, 1998) and exhibit higher blank-to-core ratios (Roth & Dibble, 1998).

Altogether, different studies highlight significant variability in lithic assemblages and raw material proportions, reflecting different facets of hunter-gatherer technological organisation. This variability appears between behaviourally and ethnically similar sites (Bamforth, 1986), across distinct chrono-cultural periods, and even within a single site among various raw materials. To fully understand past hunter-gatherer behaviours, organisation, and lifeways, it is crucial to examine all stages of lithic production - procurement, distribution, use, maintenance, and discard - through interconnected approaches that combine lithic technology and raw material analyses.

Our goal is to understand the provisioning, use and management strategies of chert lithic resources of the hunter-gatherer groups of Vale Boi during the Upper Paleolithic. We focus on the technological characteristics of the two broader groups of cherts identified at the site: local and non-local, based on the notion that local raw materials will show technological patterns different from those which are non-local. Expanding upon our previous works on chert types present throughout the UP sequence in the Terrace and Shelter area of Vale Boi, and their possible interpretations, and following the previously mentioned studies and models about raw material management and lithic technology organisation focusing mainly on the different management of local and non-local raw materials, associated with mobility and occupation length, we derive several expectations regarding local and non-local raw materials that can be found summarized in @tbl-expectations.

```{r}
#| label: tbl-expectations
#| tbl-cap: A table.

hypotheses <- readr::read_csv(here::here('analysis/data/tables/hypotheses_short.csv'))

knitr::kable(head(hypotheses))

```

Despite these expectations, it is important to notice that, especially in occupations with a high percentage of non-local cherts at the site (e.g., Gravettian occupations of level 7 and 6 of the Terrace at Vale Boi), these technological may not reflect a preoccupation with intensive management of a scarce and limited non-local resource, and be more a reflection of the type of provisioning applied following the suggested model by Kuhn (2004). In this sense, distance from source may have had little intrinsic meaning in the past, especially regarding non-local raw materials. There are several ways in which raw materials may be transported to a site, and the relationship between distance and cost may vary depending on how this takes place (Kuhn, 2004). When non-local raw materials are as abundant as local ones, the difference in the technological organization between these materials may be less obvious (Andrefsky, 2004).

# Materials and methods

## Site description

Vale Boi is situated on the western coast of the Algarve region in southern Portugal, within a small valley that stretches southward to the Atlantic coast, approximately 2 km away. The site is bordered by limestone outcrops, which form rock shelters facing west and southwest. Covering more than 10,000 square meters along the valley slope, Vale Boi includes three main excavated areas: Slope, Terrace, and Shelter, which were excavated between 2000 and 2019 (Bicho et al., 2007, 2012, 2013; Cascalheira et al., 2017; Cascalheira & Bicho, 2013; Manne et al., 2012). Based on the available raw material and technological data, particularly the macroscopic and petrographic research (Belmiro et al., 2025), the Terrace and Shelter areas were selected for the current study.

The Terrace spans occupations from the UP to the Early Neolithic. Although excavations began in 2000, a new 8-square-meter area was opened in 2012 to better understand the stratigraphic sequence and assess the potential presence of older cultural layers, which could be linked to an early Upper Paleolithic occupation. Between 2012 and 2016, eight primary litho-stratigraphic units were identified. The UP sequence includes multiple occupations, spanning \~10,000 years: Gravettian (levels 8 to 6) between approximately c. 32 and 27 ka cal BP, Proto-Solutrean (levels 5 to 4E) between approximately c. 26 and 24 ka cal BP, and Solutrean (levels 4D, 4C, 4, and Lower 3) between approximately c. 24 and 20 ka cal BP (Belmiro et al., 2021; Cascalheira et al., 2017; Cascalheira & Bicho, 2013).

The Shelter area contains four main lithostratigraphic units, with occupations from the Magdalenian, Solutrean, and Gravettian periods. The Magdalenian and Gravettian levels (Z and D, respectively) were partially eroded, while the Solutrean levels represent the most intensive occupation, with three well-preserved archaeological horizons (layers C to A), dated to approximately c. 24-22 ka cal BP. These occupation levels were found beneath blocks of limestone that likely collapsed from the rockshelter ceiling, probably shortly after the Last Glacial Maximum (Cascalheira, 2010; Cascalheira et al., 2017).

Most of these occupations resulted in large lithic assemblages, encompassing all lithic production stages and use of several raw materials, often for specific uses. Research on the lithic assemblages of the site have allowed the technological and cultural characterisation of human groups occupying the site, which show some differences through the different UP occupations. Given the chosen sample for this study (see section 2 “Materials and methods”), we summarise here the results for the technological analysis of the Solutrean assemblages (levels A-C) of the Shelter (Cascalheira, 2010; Cascalheira et al., 2013) and the Proto-Solutrean assemblages (levels 4E-5) of the Terrace (Belmiro, 2020; Belmiro et al., 2021). The Gravettian occupations (Levels 6-8) of the Terrace have been recently studied, but the results remain unpublished.

The lithic analysis of the Shelter Solutrean levels (A-C) shows a high number of lithic artifacts, with over 22 000 artifacts analysed (including chips which correspond to \~60% of the assemblage and shatter \~17-19%). The volumes introduced into the site were mostly cortical, given the high frequencies of cortex in blanks and retouched tools. The knapping strategies are dominated by unidirectional and bidirectional prismatic, with frequent core maintenance products. Flakes dominate the debitage assemblage, and endscrapers, notches, splintered pieces and retouched blades/flakes are the most common retouched tools. Stemmed and winged points, laurel leaves, shouldered points and parpalló points were also identified (Cascalheira et al., 2013).

The Proto-Solutrean horizons yielded more than 26,500 artifacts (including chips which correspond to \~65-70% of the assemblage and shatter \~20%), \~11,000 attributed to the lower bottom of level 5 and \~15,600 attributed to the top of level 5 and level 4E. Both horizons are characterised by knapping strategies dominated by unidirectional prismatic cores, with little platform preparation, focused on the obtention of bladelets (in bottom level 5) and flakes. Retouched tools are dominated by splintered pieces, endscrapers and retouched blanks, with Vale Comprido points (the Proto-Solutrean fossil director) being barely inexistent in chert and mostly produced in dolerite (Belmiro et al., 2021).

Previous studies showed that the main raw materials used at the site are chert, quartz and greywacke, with the percentages of these changing between occupations. For example, while studies show a high degree of quartz in the lower Proto-Solutrean levels (Belmiro et al., 2021), in the Solutrean occupations of the Shelter a dominance of chert was observed (Cascalheira, 2010). Similarly, different raw materials have been observed to play specific roles, such as the case of chert for the production of a high percentage of blanks and retouched tools. While quartz and greywacke can be found locally, in the streams and adjacent to the site, chert sources are further away, although still within a \~20 km radius of the site. Our previous study showed, as expected, the existence of local chert in the assemblages, originating from the Lower Jurassic outcrops in proximity to the site (Belmiro et al., 2025). As previously mentioned, a portion of non-local cherts was also identified, with some identified sources, such as the Cretaceous outcrops of Central Portugal (Lisbon and Rio Maior areas) and the Upper Jurassic oolitic/peloidal cherts of the Betic Systems in southern Spain. This suggests contacts or long-range mobility patterns of the groups occupying Vale Boi all throughout the UP, although in different degrees, possibly related to changes in the settlement patterns and duration of site occupation.

Both these areas have been previously interpreted as seasonal residential camps, repeatedly used for extended stays, due to the abundance of lithic debitage, stone tools, heat-cracked rocks related to grease rendering activities, large quantities of faunal remains (both marine and terrestrial) and the presence of ornaments and portable art [@manneIntensiveSubsistencePractices2012]. This is true for most of the occupations (levels), with exception of the Early Gravettian occupations of the Terrace area and Magdalenian occupation of the Shelter.

Using the Whole Assemblage Behavioral Index (WABI), previously used in other studies (Riel-Salvatore, 2010; Riel-Salvatore & Barton, 2004), Cascalheira et al., (2017) used the lithic results from the Shelter Solutrean levels (Cascalheira, 2010; Cascalheira et al., 2013) and Magdalenian levels (Mendonça, 2009), and the Gravettian levels of Terrace (Marreiros et al., 2015) to reconstruct and compare the mobility strategies of the several occupations, through the lithic volumetric density and the frequency of retouched tools. This method allowed the confirmation that, except from the Early Gravettian and Magdalenian occupations, all other occupations are composed of high-density assemblages with low degree of retouch, correspondent to a residential base-camp occupation, for extended periods of time. Regarding the Terrace area, however, the results were based on previous excavations (\<2012), and the identification of new layers and reorganization of the occupations is yet to be tested through the use of lithic techno-typological methods.

A similar conclusion was suggested based on the interpretation of the chert sourcing and proportions in the several UP occupations of the Terrace and Shelter of Vale Boi, and following other models relating local/non-local raw materials with mobility (Grove et al., 2023; Surovell, 2009). The high proportions of non-local chert (\~50%) in the Gravettian occupations (levels 6 and 7), and gradual reduction in the following occupations, were interpreted as a possible result of settlement changes, where the Gravettian occupations corresponded to short-term occupations, and the other occupations corresponded to residential, long-term occupations with more infrequent moves (Belmiro et al., 2025).

## Lithic analysis

The current study includes the statistical correlation between the techno-typological analysis and the geoarchaeological study of the chert lithic assemblages of the UP of Vale Boi. As mentioned above, previous studies have individually analysed the lithic assemblages from Vale Boi focusing on different subjects and methods, obtaining different kinds of data. Specifically, our previous study focused on the macroscopic and petrographic characterisation of cherts, and the identification of distance to sources and proportions through the several UP technocomplexes. This study provided the basis for understanding which cherts were being used at the site, where they were coming from and how/why their use became more or less intense. In that same study, we used previously known data related to settlement type and seasonality to contextualise the changes in chert sources and proportions through time, to better understand the possible strategies of raw material procurement (Hahn, 2002). However, and as mentioned in Belmiro et al. 2025, correlating the obtained data with technological analysis data provides a key step to better understand how these raw materials were being introduced into the site and used, through the correlation with data such as type of lithic class, since it may point towards the specific mobility of artifacts (Hahn, 2002).

This is especially relevant in a site like Vale Boi, where several technological studies have been key to understand the cultural characteristics of the groups inhabiting throughout the UP, and their possible relations within the UP in Iberia. By using previously acquired data, it becomes possible to integrate different datasets to provide a wider picture of UP occupations at Vale Boi, and using the potential of lithics to inform us of hunter-gatherer lifeways.

As such, this study includes datasets which have been previously interpreted and published, most of which can also be found in online repositories and freely consulted. As previously mentioned, the macroscopic and petrographic data of cherts was previously collected and published by our team (Belmiro et al., 2025), and can also be found in an online repository (OSF\*\*). This study focused on the UP chalcedony and chert assemblages of Vale Boi, especially the Gravettian (levels 6 and 7), Proto-Solutrean (levels 4E and 5) and Solutrean (levels 4 to 4D) from the Terrace area and the Solutrean (levels A to C) from the Shelter area. The methodology used in the study, and supporting documents, including the chert type characterisation and analysis data dictionaries can be found in the article and the online repository.

The technological analysis datasets have been collected by our team and published in previous works. The Solutrean assemblage technological analysis was published by Cascalheira (-Cascalheira, 2010), as part of a Master’s thesis and following publications, with the study of levels A to C of the Shelter area. The dataset used for this study was not originally published, but can be consulted in our online repository (++). Given the inexistence of technological studies for the Solutrean levels of the Terrace with a representative amount of lithics (level 4), the Solutrean analysis in this study is limited to the Shelter area. However, and as seen in Belmiro et al. (2025), the raw material patterns seem to show little differences between the Solutrean in both areas, thus coupled with the similar radiocarbon dates between area (c. 24-22 and 24-20 ka cal BP), we assume that they are representative of similar, long-term, residential occupations which aptly characterise the Solutrean groups of Vale Boi. The Proto-Solutrean technological analysis was the result of a Master’s thesis (Belmiro, 2020) and following publication (Belmiro et al., 2021), with the study of levels 4E and 5 of the Terrace area. The dataset used for this study can be consulted in the original online repository (++), as well as in our RStudio reproducible project, available in our online repository (\*\*). Finally, the Gravettian technological analysis was the result of a recent and unpublished study, focusing on the study of levels 6 and 7 of the Terrace area. This dataset can also be found in our online repository (++). Given the use of different datasets, collected through a wide span of time and by different researchers, a data dictionary with the variables used in this study can also be found in the Supplementary materials and in our online repository.

An inherent caveat of using datasets collected by different researchers is related to the use of different methodologies, variables and measurements. This caveat is avoided in this study since the literature, approach and analysis method used in all data collection processes was similar. The lithic analysis adopted an attribute-based methodology, which aims to describe morphological and metrical attributes of technological classes. The attributes analysed followed those present in specialized literature, such as Brézillon (1968), and Tixier and Inizan (1980), paired with other Paleolithic lithic attribute analyses (see e.g., Bicho, 1992; Zilhão, 1997; Cascalheira, 2019; Almeida, 2000; Scerri et al., 2014; Tostevin, 2013).

After data collection, the databases were imported into R Programming Environment, where the information was processed through the creation of descriptive statistical analysis and writing of this article. Some differences in the collection process, especially between the study by Cascalheira (2010) and the following studies, required homogenization. For example, where in Cascalheira (2010) retouch was an independent variable, with a Yes or No option followed by a variable to classify the type of retouch, in Belmiro (2020) and Belmiro et al. (2021), retouch was identified in the Class variable as RetouchedPiece, followed by a variable to choose the retouch typology. In this situation, the Solutrean dataset was corrected, so that all artifacts with retouch were classified as RetouchedPiece in the Class variable, instead of the original classification. The original datasets without alterations can be found in the online repository, as all the alterations to the original datasets were done through R Studio and can be found in the original R Script. Finally, technological and raw material data had to be merged in a single dataset. This was done through the merging of the several datasets through the artifact identifier “ID”, the sequential identifier which is attributed to each total station plot during excavation, whether relating to individual artifacts plotted in their exact location, or bucket coordinates, relating to the center of the excavated area, and attributed to all artifacts found in the sieved sediment in the bucket. Since the raw material study only focused piece plotted artifacts with individual coordinates (leaving out bucket artifacts), as these correspond to artifacts with dimensions superior to 2 cm or complete bladelets (thus excluding small fragments and chips), the final dataset used in this study does not directly correspond to the full datasets analysed in the original studies. Similarly, the raw material study used only currently accessible artifacts from the assemblages. This is especially relevant for the Shelter Solutrean chert assemblage, where shatter is absent from the sample due to the availability for study. This stands as a caveat for the current study, since it is using only portion of the assemblages, leaving out possibly important debris. Despite this, the current study still offers a novel and key approach to the study of lithic assemblages at the site, with a methodology that includes all the knapping sequence, of a large number of artifacts from the UP sequence of a single site, as seen in table \*\*, which shows the number of artifacts used in the final analysis of this paper, after corrections, homogenization and merging.

```{r}
#| label: tbl-samples
#| tbl-cap: "Sample absolute number comparison between original datasets (chert and chalcedony only) for the Solutrean occupation of the Shelter area (levels A-C) published in Cascalheira (2010), the Proto-Solutrean occupation of the Terrace (levels 4E and 5) published in Belmiro et. al., (2021) and the Solutrean occupation of the Terrace (levels 6-7) and the final datasets used in the study after filtering individually plotted IDs (excluding bucket points) and merging with the geoarchaeological dataset published in Belmiro et al., (2025)."

table_samples <- tibble::tribble(
  ~Assemblage, ~`Original dataset (n)`, ~`Merged dataset (n)`,
  "Shelter level A-C", 3359, 910,
  "Terrace level 4E-5", 1821, 635,
  "Terrace level 6-7", 781, 766)

knitr::kable(head(table_samples))

```

After the homogenization and merging of the datasets, descriptive statistical analysis was applied to describe and interpret the relation between the raw material and technological data. As mentioned above, the goal of the study was to test two hypotheses related to the technological organisation of local and non-local cherts, and between different UP occupations. To test these hypotheses, we evaluated several parameters for each dataset and assemblage and compared the results between chert types and assemblages. The parameters evaluated in the current study were: P1) frequency of retouched tools; P2) frequency of cores; P3) frequency of maintenance products; P4) debitage sizes; P5) tools-to-debitage ratios; P6) core sizes; P7) blank-to-core ratios; P8) tool diversity; P9) tool specialization. Debitage and core sizes were analysed through descriptive statistics (mean and sd tables available in the SOM\*\*) and plotted through boxplots and through non-parametric statistical analyses (Mann-Whitney U test). The ratios were obtained through the division of each group (e.g., tools by debitage and blanks by core), by chert type and assemblage. All other parameters were observed through number and percentages tables. All the analyses were done through code in R Studio.

The entirety of the R code used for the analysis, datasets, and visual representations contained in this paper can be accessed through our online research compendium. We used the rrtools package by Marwick et al. [-@marwickPackagingDataAnalytical2018] to create a research compendium and write a reproducible journal article. The provided files include the complete set of raw data used in the analysis, along with a custom R project [@wickhamPackagesOrganizeTest2015] containing the code required to generate all tables and figures. To enable maximum reuse, the code is made available under the MIT license, data under CC‐0, and figures under CC‐BY [additional details can be found in @marwickComputationalReproducibilityArchaeological2017].

# Results

```{r}
#| label: get-data

# Reading the datasets
## Technological data
gravettian_tech <- read_csv(here::here('analysis/data/raw_data/VBT_6_7_JB.csv'))
proto_tech <- read_csv(here::here('analysis/data/raw_data/VBT_4E_5_JB.csv'))
solutrean_JC <- read_csv(here::here('analysis/data/raw_data/VBR_ABC_JC.csv'))
solutrean_points <- read_csv(here::here('analysis/data/raw_data/shelter_points_JC.csv'))

## RM data
shelter_RM <- read_csv(here::here('analysis/data/raw_data/MACRO_IND_SHELTER.csv')) # Shelter RM analysis
terrace_RM <- read_csv(here::here('analysis/data/raw_data/MACRO_IND_TERRACE.csv')) # Terrace RM analysis

## Context data
context <- read_csv(here::here('analysis/data/raw_data/VB_Terrace_context.csv')) # Terrace Field DB - lithic artefact info
xyz <- read_csv(here::here('analysis/data/raw_data/VB_Terrace_xyz.csv')) # Terrace Field DB - just coordinates

```

```{r}
#| label: terrace-databases-setup

# Setting up the Terrace dataset
cols_to_concat_terrace <- c("UNIT", "ID") # Vector to join UNIT and ID into a single variable
context$ID <- str_squish(context$ID) # Remove empty spaces from ID field
xyz$ID <- str_squish(xyz$ID) # Remove empty spaces from UNIT field

# Cleaning up DS and uniformising variable names
proto_tech_WIP <- proto_tech |>
  tidyr::unite(col='ID', all_of(cols_to_concat_terrace), sep="-", remove=TRUE) |> 
  rename(CLASS = Class, COREPREPPROD = CorePreparProd, PIECECOMPLETENESS = PieceCompleteness, CORTEX = Cortex, CORTEXLOCATION = CortexLocation, PLATFORMTYPE = PlatformType, PLATFORMCORTEX = PlatformCortex, SCARCOUNT = ScarCount, THICKNESS = Thickness,
        MAXWIDTH = MaxWidth, LENGTH = Length, COREPLATFORM = CorePlatform, MAINFACECORTEX = MainFaceCortex, 
        MAINFACESCARCOUNT = MainFaceScarCount, COREABANDON = CoreAbandon, RETOUCHEDPIECETYPOLOGY = RetouchedPieceTypology) |> 
  dplyr::select(ID, CLASS, COREPREPPROD, PIECECOMPLETENESS, CORTEX, CORTEXLOCATION, PLATFORMTYPE, PLATFORMCORTEX,
                SCARCOUNT, THICKNESS, MAXWIDTH, LENGTH, COREPLATFORM, MAINFACECORTEX, MAINFACESCARCOUNT, COREABANDON, RETOUCHEDPIECETYPOLOGY)

gravettian_tech <- gravettian_tech |> 
  mutate(CLASS = case_when(
    CLASS == "Flake" | CLASS == "ElongBlank" ~ "Blank",
    CLASS == "FlakeFrag" | CLASS == "ElongBlankFrag" ~ "BlankFrag",
    TRUE ~ CLASS))

terrace_tech <- bind_rows(proto_tech_WIP, gravettian_tech) # Creating single DS with Proto and Gravettian

terrace_RM_WIP <- terrace_RM |> 
  mutate(RMTYPE = case_when(
    RMTYPE == "TYPE 2" | RMTYPE == "Type 2" ~ "T2",
    RMTYPE == "Chalcedony" ~ "T1", # Altering first group names to final group names. Subtypes are maintained as before.
    RMTYPE == "TYPE 15" ~ "T3",
    RMTYPE == "TYPE 7" ~ "T4",
    RMTYPE == "TYPE 12" ~ "T5",
    RMTYPE == "TYPE 11" ~ "T6",
    RMTYPE == "TYPE 13" ~ "T7",
    RMTYPE == "TYPE 11F" ~ "T8",
    RMTYPE == "TYPE 13B" ~ "T9",
    RMTYPE == "Oolitic" ~ "T10",
    RMTYPE == "TYPE GB" ~ "T11",
    .default = RMTYPE)) |> 
  select(AREA, ID, RMTYPE, SUBTYPE, WEIGHT, CORTEXTHICKNESS, CORTEXAPPEARANCE) |> 
  distinct(ID, .keep_all = TRUE)

context <- context |>
  dplyr::rename("UNIT" = "Unit") |> # Renaming first column from Unit to UNIT to use cols_to_concat
  unite(col='ID', cols_to_concat_terrace, sep="-", remove=FALSE) |> # Unite UNIT with ID using cols_to_concat
  select(ID, Level, Spit, Code) |> # Selecting important variables: ID refers to artifact ID; Level refers to archaeologycal layer; Spit refers to artificial levels within an archaeological layer; Code refers to type of artifact (e.g., LITHIC or BONE)
  distinct(ID, .keep_all = TRUE)

xyz <- xyz |>
  unite(col='ID', cols_to_concat_terrace, sep="-", remove=FALSE) |> # Unite UNIT with ID using cols_to_concat
  filter(Suffix == 0) |> # To avoid several entries related to several points of the same artefact
  select(ID, X, Y, Z) |> # Selecting important variables
  distinct(ID, .keep_all = TRUE)

field_data <- full_join(xyz, context, by = "ID") # Join field tables

terrace_tech_WIP <- left_join(terrace_tech, field_data, by = "ID") # Join field and RM type tables
terrace_dataset <- full_join(terrace_tech_WIP, terrace_RM_WIP, by = "ID") # Base 12690
terrace_dataset <- terrace_dataset |>
  filter(!Level %in% c("3", "4", "4C", "4D")) |>  # Dropping NAs on the technological class drops dataset to 1651
  drop_na(RMTYPE) |>  # Dropping NAs on the RM database drops dataset to 3635
  drop_na(CLASS) # Dropping NAs on the technological class drops dataset to 1647
  
# Mutate level 5 to add phases: top of 5 (4E/5) and bottom of 5 (5), following Belmiro et al. (2020).
phase_dataset <- terrace_dataset |> 
  mutate(Level = case_when(
    Level == 5 & Z > 24.1 ~ "4E/5",
    Level == 5 & Z < 24.1 ~ "5",
    Level == "7C" | Level == 8 ~ "7", # Collapsing samples from Level 7C and Level 8 into 7 to homogenise dataset
    TRUE ~ Level)) |> # Adding technocomplex name based on the levels
  mutate(Technocomplex = case_when(
    Level == "4E" | Level == "4E/5" | Level == 5 ~ "Proto-Solutrean",
    Level == 6 | Level == 7 ~ "Gravettian")) |> 
  mutate(RETOUCHEDPIECETYPOLOGY = case_when( # Simplifying the retouched typology
    RETOUCHEDPIECETYPOLOGY == "Splintered piece with notch" | RETOUCHEDPIECETYPOLOGY == "Splintered piece with lateral retouch" | RETOUCHEDPIECETYPOLOGY == "Splintered piece fragment" ~ "Splintered piece",
    RETOUCHEDPIECETYPOLOGY == "Retouched blade" | RETOUCHEDPIECETYPOLOGY == "Retouched bladelet" | RETOUCHEDPIECETYPOLOGY == "Retouched flake" | RETOUCHEDPIECETYPOLOGY == "Retouched burin spall" ~ "Retouched blank",
    RETOUCHEDPIECETYPOLOGY == "Retouched bladelet frag" | RETOUCHEDPIECETYPOLOGY == "Retouched flake frag" | RETOUCHEDPIECETYPOLOGY == "Retouched flake siret fragment"  ~ "Retouched blank fragment",
    RETOUCHEDPIECETYPOLOGY == "Multiple burin" | RETOUCHEDPIECETYPOLOGY == "Burin splintered piece" | RETOUCHEDPIECETYPOLOGY == "Burin on truncation" | RETOUCHEDPIECETYPOLOGY == "Retouched burin" ~ "Burin",
    RETOUCHEDPIECETYPOLOGY == "Dentilhado" ~ "Denticulate",
    RETOUCHEDPIECETYPOLOGY == "Right truncation on retouched piece" ~ "Truncation",
    RETOUCHEDPIECETYPOLOGY == "Backed bladelet" | RETOUCHEDPIECETYPOLOGY == "Backed flake" | RETOUCHEDPIECETYPOLOGY == "Double backed bladelet" | RETOUCHEDPIECETYPOLOGY == "Backed bladelet parcial" ~ "Backed tool",
    TRUE ~ RETOUCHEDPIECETYPOLOGY))

```

```{r}
#| label: shelter-solutrean-setup

# Setting up the Shelter dataset
cols_to_concat_shelter <- c("YEAR", "ID") # Concatenate YEAR and ID variables in one single variable (e.g. 05-500)

solutrean_WIP <- solutrean_JC |> 
  filter(Layer %in% c("A", "B", "C")) |> # Filtering Solutrean layers
  filter(`Raw material` %in% c("Chert", "Chalcedony")) |>  # Filtering raw materials
  filter(!Screen %in% c("Crivo", "crivo")) |>  # Filtering out all bucket lithics since they were not included in the RM analysis
  mutate_at("Date", str_replace, "20", "") |> # Removing initial part of the year to match IDs
  dplyr::rename("YEAR" = "Date") |> 
  tidyr::unite(col='ID', all_of(cols_to_concat_shelter), sep="-", remove=FALSE) # Concatenate YEAR and ID variables in one single variable (e.g. 05-500)

# Dataset filtering for chert/chalcedony and levels (A-C), 3229 + 61 solutrean points, n=2390
solutrean_original_chert <- solutrean_JC |> 
  filter(Layer %in% c("A", "B", "C")) |> # Filtering Solutrean layers
  filter(`Raw material` %in% c("Chert", "Chalcedony")) |> 
  filter(Class != "Chip")

# In Cascalheira 2010 Retouched piece was not a category but a variable. To match the other DBs, this category was added
solutrean_WIP <- solutrean_WIP |> 
  mutate(Class = case_when( # This alteration is being done on the original class column
    Retouched == "Yes" ~ "RetouchedPiece", # Whenever retouch is present, class is now Retouched piece
    TRUE ~ Class)) |> 
  mutate(CLASS = case_when( # Creating a column for clustered classes, to match the other DBs
    Class == "Blade" | Class == "Bladelet" ~ "ElongBlank", # Cluster blades with bladelets. The distinction can come later through a mutate and the measurements
    Class == "Core front" | Class == "Core tablet" | Class == "Core trimming elem." | Class == "Crested piece" ~ "CorePrepProd", # Cluster all preparation products
    Class == "Fragment" ~ "Shatter",
    Class == "Flake distal frag." | Class == "Flake mesial frag." | Class == "Flake prox. frag." ~ "FlakeFrag", # Cluster flake frags into a single category
    Class == "Blade distal frag." | Class == "Blade mesial frag." | Class == "Blade prox. frag." 
    | Class == "Bladelet distal frag." | Class == "Bladelet mesial frag." | Class == "Bladelet prox. frag." ~ "ElongBlankFrag", # Cluster elong frags into a single category
    TRUE ~ Class)) |> 
  mutate(COREPREPPROD = case_when( # Creating a column for the types of core preparation and maintenance products (COREPREPPROD)
    Class == "Core front" ~ "Core front",
    Class == "Core tablet" ~ "Core tablet",
    Class == "Core trimming elem." ~ "Core trim",
    Class == "Crested piece" ~ "Crested piece")) |> 
  mutate(PIECECOMPLETENESS = case_when( # Creating a column for the portions present in flake or elongblank fragments to match other DBs
    Class == "Flake distal frag." | Class == "Blade distal frag." | Class == "Bladelet distal frag." ~ "Distal",
    Class == "Flake mesial frag." | Class == "Blade mesial frag." | Class == "Bladelet mesial frag." ~ "Mesial",
    Class == "Flake prox. frag." | Class == "Blade prox. frag." | Class == "Bladelet prox. frag." ~ "Proximal")) |> 
  rename(PLATFORMTYPE = Platform_type) |> # Renaming column
  mutate(PLATFORMTYPE = case_when( # Renaming variables to match correspondent variables in the other DBs
    PLATFORMTYPE == "Multifacetted" ~ "Faceted",
    PLATFORMTYPE == "Unfacetted" ~ "Plain",
    TRUE ~ PLATFORMTYPE)) |>
  mutate(Type = case_when( # Translating retouched types from Zilhão 1997 to simplified typologies
    Type == "92b" ~ "Retouched piece fragment",
    Type == "92a" ~ "Retouched blank",
    Type == "76" ~ "Splintered piece",
    Type == "75" ~ "Denticulate",
    Type == "74" ~ "Notch",
    Type == "66" ~ "Retouched blade",
    Type == "61" ~ "Truncation",
    Type == "28" ~ "Burin",
    Type == "7" | Type == "5b" | Type == "4"  ~ "Endscrapper",
    TRUE ~ Type)) |>
  rename(LEVEL = Layer, UNIT = Unit, CORTEX = Percent_of_cortex, CORTEXLOCATION = Loc_of_cortex, THICKNESS = Thickness,
         MAXWIDTH = Width, LENGTH = Length, COREPLATFORM = Core_platfform, SCARCOUNT = N_of_Scars, COREABANDON = Core_abandon,
         RETOUCHEDPIECETYPOLOGY = Type)  # Renaming column
  
solutrean_tech <- solutrean_WIP |>
  dplyr::select(ID, CLASS, LEVEL, UNIT, COREPREPPROD, PIECECOMPLETENESS, CORTEX, CORTEXLOCATION, PLATFORMTYPE,
                SCARCOUNT, THICKNESS, MAXWIDTH, LENGTH, COREPLATFORM, COREABANDON, RETOUCHEDPIECETYPOLOGY)

solutrean_points <- solutrean_points |> 
  mutate_at("YEAR", str_replace, "20", "") |> # Removing initial part of the year to match IDs
  tidyr::unite(col='ID', all_of(cols_to_concat_shelter), sep="-", remove=TRUE)
  
solutrean_tech <- bind_rows(solutrean_tech, solutrean_points) # Uniting technology dataset with points (2167 to 2228)

solutrean_tech <- solutrean_tech |> # Originally 2228
  distinct(ID, .keep_all = TRUE) # Keeping individual IDs to avoid buckets (down to 1993)

shelter_RM_WIP <- shelter_RM |>
  mutate_at("ID", str_replace, "VB", "") |> # Remove "VB" from ID
  mutate(RMTYPE = case_when(
    RMTYPE == "Type 2" | RMTYPE == "TYPE 2" ~ "T2",
    RMTYPE == "Chalcedony" ~ "T1", # Altering first group names to final group names. Subtypes are maintained as before.
    RMTYPE == "TYPE 15" ~ "T3",
    RMTYPE == "TYPE 7" ~ "T4",
    RMTYPE == "TYPE 12" ~ "T5",
    RMTYPE == "TYPE 11" ~ "T6",
    RMTYPE == "TYPE 13" ~ "T7",
    RMTYPE == "TYPE 11F" ~ "T8",
    RMTYPE == "TYPE 13B" ~ "T9",
    RMTYPE == "Oolitic" ~ "T10",
    RMTYPE == "TYPE GB" ~ "T11",
    RMTYPE == "ND_A" ~ "INDET",
    .default = RMTYPE)) |>
  select(AREA, ID, RMTYPE, SUBTYPE, WEIGHT, CORTEXTHICKNESS, CORTEXAPPEARANCE) |>  # Select variables
  distinct(ID, .keep_all = TRUE) # Keeping individual IDs to avoid buckets

solutrean_dataset <- full_join(solutrean_tech, shelter_RM_WIP, by = "ID") # The complete dataset has 2818 (44 points) entries
solutrean_dataset <- solutrean_dataset |>
  drop_na(RMTYPE) |>   # Dropping NAs on the RM database drops dataset to 1514
  drop_na(CLASS) |>  # Dropping NAs on the technological class drops dataset to 914
  dplyr::mutate(RETOUCHEDPIECETYPOLOGY = case_when(
    RETOUCHEDPIECETYPOLOGY == "Bifacial fragment" ~ "Bifacial blank",
    RETOUCHEDPIECETYPOLOGY == "Shouldered point fragment" ~ "Shouldered point",
    TRUE ~ RETOUCHEDPIECETYPOLOGY))
  
```

```{r}
#| label: general-tables
#| include: false

# Tables with class by raw material type (n and %)
##
general_table <- phase_dataset |> 
    dplyr::mutate(RMTYPE = case_when(
    RMTYPE == "T1" | RMTYPE == "T2" | RMTYPE == "T3" | RMTYPE == "T4" | RMTYPE == "T5" ~ "Local",
    TRUE ~ RMTYPE)) |> 
  dplyr::mutate(CLASS = case_when(
    CLASS == "BlankFrag" ~ "Blank fragment",
    CLASS == "BurinSpall" ~ "Burin spall",
    CLASS == "CoreFrag" ~ "Core fragment",
    CLASS == "CorePreparProd" ~ "Core prep product",
    CLASS == "RetouchedPiece" ~ "Retouched",
    CLASS == "RetouchedPieceFrag" ~ "Retouched fragment",
    TRUE ~ CLASS))

general_table_solutrean <- solutrean_dataset |> 
   dplyr::mutate(RMTYPE = case_when(
    RMTYPE == "T1" | RMTYPE == "T2" | RMTYPE == "T3" | RMTYPE == "T4" | RMTYPE == "T5" ~ "Local",
    TRUE ~ RMTYPE)) |> 
  dplyr::mutate(CLASS = case_when(
    CLASS == "ElongBlank" | CLASS == "Flake" ~ "Blank",
    CLASS == "ElongBlankFrag" | CLASS == "FlakeFrag" ~ "Blank fragment",
    CLASS == "Thinning flake" ~ "Blank",
    CLASS == "CorePrepProd" ~ "Core prep product",
    CLASS == "RetouchedPiece" | CLASS == "Retouched piece" ~ "Retouched",
    CLASS == "Retouched piece fragment" ~ "Retouched fragment",
    TRUE ~ CLASS))

## For Gravettian
gravettian_general <- general_table |>
  filter(Level %in% c(6, 7)) |>
  filter(RMTYPE != "INDET") |> 
  mutate(RMTYPE = factor(RMTYPE, levels = c("Local", "T6","T7", 
                                        "T8", "T9", "T10", "TL"))) |>
  tabyl(CLASS, RMTYPE) |> 
  adorn_totals(c("row", "col")) |> 
  adorn_percentages("col") |> 
  adorn_pct_formatting(2) |> 
  adorn_ns("front") |> 
  mutate(across(where(is.character), ~ gsub("^0   \\(0\\.00%\\)$", " ", .)))

## For Proto-Solutrean (4E and top of 5)
proto_general <- general_table |> 
  filter(Level %in% c("4E", "4E/5")) |> 
  filter(CLASS != "Chip") |> 
  filter(RMTYPE != "INDET") |> 
  mutate(RMTYPE = factor(RMTYPE, levels = c("Local", "T6","T7", 
                                        "T8", "T9", "T10", "TL"))) |> 
  tabyl(CLASS, RMTYPE) |> 
  adorn_totals(c("row", "col")) |> 
  adorn_percentages("col") |> 
  adorn_pct_formatting(2) |> 
  adorn_ns("front") |> 
  mutate(across(where(is.character), ~ gsub("^0   \\(0\\.00%\\)$", " ", .)))

## For Solutrean
solutrean_general <- general_table_solutrean |> 
  filter(RMTYPE != "INDET") |> 
  mutate(RMTYPE = factor(RMTYPE, levels = c("Local", "T6","T7", 
                                        "T8", "T9", "T10", "T11", "TL"))) |> 
  tabyl(CLASS, RMTYPE) |> 
  adorn_totals(c("row", "col")) |> 
  adorn_percentages("col") |> 
  adorn_pct_formatting(2) |> 
  adorn_ns("front") |> 
  mutate(across(where(is.character), ~ gsub("^0   \\(0\\.00%\\)$", " ", .)))

```

```{r}
#| label: general-graphs

barplot_gravettian <- phase_dataset |> 
    dplyr::mutate(RMTYPE = case_when(
    RMTYPE == "T1" | RMTYPE == "T2" | RMTYPE == "T3" | RMTYPE == "T4" | RMTYPE == "T5" ~ "Local",
    TRUE ~ RMTYPE)) |> 
  dplyr::mutate(CLASS = case_when(
    CLASS == "BlankFrag" ~ "Blank",
    CLASS == "BurinSpall" ~ "Burin spall",
    CLASS == "CoreFrag" ~ "Core",
    CLASS == "CorePreparProd" ~ "Core prep product",
    CLASS == "RetouchedPiece" | CLASS == "RetouchedPieceFrag" ~ "Retouched",
    TRUE ~ CLASS)) |> 
  filter(Level %in% c(6, 7)) |>
  filter(RMTYPE != "INDET") |> 
  mutate(RMTYPE = factor(RMTYPE, levels = c("Local", "T6","T7", 
                                        "T8", "T9", "T10", "TL"))) |>
  dplyr::group_by(RMTYPE, CLASS) |> 
  dplyr::summarise(n = n()) |> 
  mutate(percent = n/sum(n)) |>
  ggplot(aes(x = RMTYPE, y = percent, fill = CLASS)) +
  geom_bar(stat = "identity", width = 0.5) +
  geom_text(aes(label=ifelse(n > 3, n, "")), position = position_stack(vjust = .5), size = 3, color = "white") +
  scale_y_continuous(labels = scales::percent_format()) +
  theme_minimal() +
  theme(axis.title.x=element_blank()) +
  labs(y = " ") +
  scale_fill_manual(name = "Class", values = c("#D49B54", "#8B6969", "#CDAF95", "#2B4F60",
                              "tomato4", "#798777"))

barplot_proto <- phase_dataset |> 
    dplyr::mutate(RMTYPE = case_when(
    RMTYPE == "T1" | RMTYPE == "T2" | RMTYPE == "T3" | RMTYPE == "T4" | RMTYPE == "T5" ~ "Local",
    TRUE ~ RMTYPE)) |> 
  dplyr::mutate(CLASS = case_when(
    CLASS == "BlankFrag" ~ "Blank",
    CLASS == "BurinSpall" ~ "Burin spall",
    CLASS == "CoreFrag" ~ "Core",
    CLASS == "CorePreparProd" ~ "Core prep product",
    CLASS == "RetouchedPiece" | CLASS == "RetouchedPieceFrag" ~ "Retouched",
    TRUE ~ CLASS)) |> 
  filter(Level %in% c("4E", "4E/5")) |>
  filter(RMTYPE != "INDET") |> 
  filter(CLASS != "Chip") |> 
  mutate(RMTYPE = factor(RMTYPE, levels = c("Local", "T6","T7", 
                                        "T8", "T9", "T10", "TL"))) |>
  dplyr::group_by(RMTYPE, CLASS) |> 
  dplyr::summarise(n = n()) |> 
  mutate(percent = n/sum(n)) |>
  ggplot(aes(x = RMTYPE, y = percent, fill = CLASS)) +
  geom_bar(stat = "identity", width = 0.5) +
  geom_text(aes(label=ifelse(n > 3, n, "")), position = position_stack(vjust = .5), size = 3, color = "white") +
  scale_y_continuous(labels = scales::percent_format()) +
  labs(y = " ") +
  theme_minimal() +
  theme(axis.title.x=element_blank()) +
  scale_fill_manual(values = c("#D49B54", "#8B6969", "#CDAF95", "#2B4F60",
                              "tomato4", "#798777"))

barplot_solutrean <- solutrean_dataset |> 
   dplyr::mutate(RMTYPE = case_when(
    RMTYPE == "T1" | RMTYPE == "T2" | RMTYPE == "T3" | RMTYPE == "T4" | RMTYPE == "T5" ~ "Local",
    TRUE ~ RMTYPE)) |> 
  dplyr::mutate(CLASS = case_when(
    CLASS == "ElongBlank" | CLASS == "Flake" ~ "Blank",
    CLASS == "ElongBlankFrag" | CLASS == "FlakeFrag" ~ "Blank",
    CLASS == "Thinning flake" ~ "Blank",
    CLASS == "CorePrepProd" ~ "Core prep product",
    CLASS == "RetouchedPiece" | CLASS == "Retouched piece" | CLASS == "Retouched piece fragment" ~ "Retouched",
    CLASS == "Core fragment" ~ "Core",
    TRUE ~ CLASS)) |> 
  filter(RMTYPE != "INDET") |> 
  mutate(RMTYPE = factor(RMTYPE, levels = c("Local", "T6","T7", 
                                        "T8", "T9", "T10","T11", "TL"))) |>
  dplyr::group_by(RMTYPE, CLASS) |> 
  dplyr::summarise(n = n()) |> 
  mutate(percent = n/sum(n)) |>
  ggplot(aes(x = RMTYPE, y = percent, fill = CLASS)) +
  geom_bar(stat = "identity", width = 0.5) +
  geom_text(aes(label=ifelse(n > 3, n, "")), position = position_stack(vjust = .5), size = 3, color = "white") +
  scale_y_continuous(labels = scales::percent_format()) +
  labs(y = " ") +
  theme_minimal() +
  theme(axis.title.x=element_blank()) +
  scale_fill_manual(values = c("#D49B54", "#8B6969", "#CDAF95", "#2B4F60",
                              "tomato4", "#798777"))

```

```{r}
#| label: stats-setup

# Scatterplots for width and length and Boxplots for weight by assemblage

# Solutrean statistics
# DS preparation
solutrean_stats <- solutrean_dataset |> 
  filter(RMTYPE != "INDET") |>
   mutate(CLASS = case_when(
    CLASS == "ElongBlank" ~ "Blank",
    CLASS == "Flake" ~ "Blank",
    CLASS == "FlakeFrag" | CLASS == "ElongBlankFrag" ~ "BlankFrag",
    TRUE ~ CLASS)) |> 
  dplyr::mutate(RMTYPE = case_when(
    RMTYPE == "T1" | RMTYPE == "T2" | RMTYPE == "T3" | RMTYPE == "T4" | RMTYPE == "T5" ~ "Local",
    TRUE ~ RMTYPE))

# Scatterplot for width and length
solutrean_scatter <- solutrean_stats |>
  filter(CLASS %in% c("Blank", "Core")) |>
  filter(MAXWIDTH !="0" & LENGTH != "0") |>
  mutate(RMTYPE = factor(RMTYPE, levels = c("Local", "T6","T7", 
                                        "T8", "T9", "T10", "T11", "TL"))) |>
  mutate(CLASS = factor(CLASS, levels = c("Blank", "Core"))) |>
  ggplot(aes(x = LENGTH, y = MAXWIDTH, fill = RMTYPE)) +
  geom_point(alpha = 0.9, size = 3, shape = 21, colour = "black") +
  facet_wrap(~CLASS) +
  labs(x="Length (mm)", y="Max. Width (mm)") +
  scale_fill_manual(name = "Chert type", values = c("#D49B54", "#8B6969", "#CDAF95", "#2B4F60",
                              "tomato4", "#BDC7C9", "#798777"))

# Boxplot for individual measurements
# Weight
solutrean_stats_weight <- solutrean_stats |>
  filter(CLASS %in% c("Blank", "Core")) |> 
  filter(WEIGHT !="0") |>
  mutate(RMTYPE = factor(RMTYPE, levels = c("Local", "T6","T7", 
                                        "T8", "T9", "T10", "T11", "TL"))) |>
  mutate(CLASS = factor(CLASS, levels = c("Blank", "Core"))) |>
  ggplot(aes(RMTYPE, WEIGHT, fill = RMTYPE)) +
  geom_boxplot(aes(fill=factor(RMTYPE)), outlier.shape=21) +
  facet_wrap(~CLASS, scales = "free_y") +
  stat_summary(fun=mean, geom="point", shape=23) +
  labs(y="Weight (gr)") +
  #coord_cartesian(ylim =  c(0, 50)) +
  scale_fill_manual(values = c("#D49B54", "#8B6969", "#CDAF95", "#2B4F60",
                              "tomato4", "#BDC7C9", "#798777")) +
  theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank(), axis.title.x = element_blank())

# Proto-Solutrean statistics
# DS prep
proto_stats <- phase_dataset |> 
  filter(Level %in% c("4E", "4E/5")) |> 
  filter(!RMTYPE == "INDET") |>
  dplyr::mutate(RMTYPE = case_when(
    RMTYPE == "T1" | RMTYPE == "T2" | RMTYPE == "T3" | RMTYPE == "T4" | RMTYPE == "T5" ~ "Local",
    TRUE ~ RMTYPE))

# Scatterplots for width and length
proto_scatter <- proto_stats |>
  filter(CLASS %in% c("Blank", "Core")) |>
  filter(MAXWIDTH !="0" & LENGTH != "0") |>
   mutate(RMTYPE = factor(RMTYPE, levels = c("Local", "T6","T7", 
                                        "T8", "T9", "T10", "TL"))) |>
  mutate(CLASS = factor(CLASS, levels = c("Blank", "Core"))) |>
  ggplot(aes(x = LENGTH, y = MAXWIDTH, fill = RMTYPE)) +
  geom_point(alpha = 0.9, size = 3, shape = 21, colour = "black") +
  facet_wrap(~CLASS) +
  labs(x="Length (mm)", y="Max. Width (mm)") +
  scale_fill_manual(name = "Chert type", values = c("#D49B54", "#8B6969", "#CDAF95", "#2B4F60",
                              "tomato4", "#BDD2B6", "#798777", "#BDC7C9"))

# Boxplots weight
proto_stats_weight <- proto_stats |>
  filter(CLASS %in% c("Blank", "Core")) |> 
  filter(WEIGHT !="0") |>
  mutate(RMTYPE = factor(RMTYPE, levels = c("Local", "T6", "T7", "T8", "T9", "T10", "TL"))) |>
  mutate(CLASS = factor(CLASS, levels = c("Blank", "Core"))) |>
  ggplot(aes(RMTYPE, WEIGHT, fill = RMTYPE)) +
  geom_boxplot(aes(fill=factor(RMTYPE)), outlier.shape=21) +
  facet_wrap(~CLASS, scales = "free_y") +
  stat_summary(fun.y=mean, geom="point", shape=23) +
  labs(y="Weight (gr)") +
  #coord_cartesian(ylim =  c(0, 50)) +
  scale_fill_manual(values = c("#D49B54", "#8B6969", "#CDAF95", "#2B4F60",
                              "tomato4", "#BDD2B6", "#798777", "#BDC7C9")) +
  theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank(), axis.title.x = element_blank())


# Gravettian statistics
# DS prep
gravettian_stats <- phase_dataset |>
  filter(Level %in% c(6, 7)) |>
  filter(RMTYPE != "INDET") |>
  dplyr::mutate(RMTYPE = case_when(
    RMTYPE == "T1" | RMTYPE == "T2" | RMTYPE == "T3" | RMTYPE == "T4" | RMTYPE == "T5" ~ "Local",
    TRUE ~ RMTYPE))

# Scatterplots for width and length
gravettian_scatter <- gravettian_stats |>
  filter(CLASS %in% c("Blank", "Core")) |>
  filter(MAXWIDTH !="0" & LENGTH != "0") |>
   mutate(RMTYPE = factor(RMTYPE, levels = c("Local", "T6","T7", 
                                        "T8", "T9", "T10", "TL"))) |>
  mutate(CLASS = factor(CLASS, levels = c("Blank", "Core"))) |>
  ggplot(aes(x = LENGTH, y = MAXWIDTH, fill = RMTYPE)) +
  geom_point(alpha = 0.9, size = 3, shape = 21, colour = "black") +
  facet_wrap(~CLASS) +
  labs(x="Length (mm)", y="Max. Width (mm)") +
  scale_fill_manual(name = "Chert type", values = c("#D49B54", "#8B6969", "#CDAF95", "#2B4F60",
                              "#8B7D6B", "#BDD2B6", "#798777", "#BDC7C9"))

# Boxplots
# Weight
gravettian_stats_weight <- gravettian_stats |>
  filter(CLASS %in% c("Blank", "Core")) |> 
  filter(WEIGHT !="0") |>
  filter(!(RMTYPE == "Local" & WEIGHT > 40)) |> # Removed a single outlier at 60 weight while ensuring that the data remains consistent. Only mean changed significantly and was normalised
  mutate(RMTYPE = factor(RMTYPE, levels = c("Local", "T6", "T7", "T8", "T9", "T10", "TL"))) |>
  mutate(CLASS = factor(CLASS, levels = c("Blank", "Core"))) |>
  ggplot(aes(RMTYPE, WEIGHT, fill = RMTYPE)) +
  geom_boxplot(aes(fill=factor(RMTYPE)), outlier.shape=21) +
  facet_wrap(~CLASS, scales = "free_y") +
  stat_summary(fun.y=mean, geom="point", shape=23) +
  labs(y="Weight (gr)") +
  #coord_cartesian(ylim =  c(0, 60)) +
  scale_fill_manual(values = c("#D49B54", "#8B6969", "#CDAF95", "#2B4F60",
                              "#8B7D6B", "#BDD2B6", "#798777", "#BDC7C9")) +
  theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank(), axis.title.x = element_blank())

```

```{r}
#| label: ratiobc

# DS preparation and tool-to-debitage ratio tables
## For Gravettian
gravettian_ratiobc <- phase_dataset |> 
  filter(Level %in% c(6, 7)) |> 
  filter(RMTYPE != "INDET") |> 
  mutate(CLASS = case_when(
    CLASS == "BlankFrag" & PIECECOMPLETENESS == "Proximal" ~ "Blank", # To add proximal fragments to ratio
    TRUE ~ CLASS)) |> 
  filter(CLASS %in% c("Blank", "Core")) |> 
  count(RMTYPE, CLASS, sort = TRUE) |> 
  group_by(RMTYPE, CLASS) |>
  summarise(n=sum(n)) |> 
  spread(CLASS, n, fill=0) |> 
  mutate(sum = rowSums(across(where(is.numeric)))) |> 
  filter(!sum <= 5) |> 
  mutate("Blank/Core" = Blank / Core)

# For Proto-Solutrean
proto_ratiobc <- phase_dataset |> 
  filter(Level %in% c("4E", "4E/5")) |> 
  filter(RMTYPE != "INDET") |> 
  mutate(CLASS = case_when(
    CLASS == "BlankFrag" & PIECECOMPLETENESS == "Proximal" ~ "Blank", # To add proximal fragments to ratio
    TRUE ~ CLASS)) |> 
  filter(CLASS %in% c("Blank", "Core")) |> 
  count(RMTYPE, CLASS, sort = TRUE) |> 
  group_by(RMTYPE, CLASS) |>
  summarise(n=sum(n)) |> 
  spread(CLASS, n, fill=0) |> 
  mutate(sum = rowSums(across(where(is.numeric)))) |> 
  filter(!sum <= 5) |>
  mutate("Blank/Core" = Blank / Core)

# For Solutrean
solutrean_ratiobc <- solutrean_dataset |> 
  mutate(CLASS = case_when(
    CLASS == "Flake" | CLASS == "ElongBlank" | CLASS == "Thinning flake" ~ "Blank",
    CLASS == "FlakeFrag" | CLASS == "ElongBlankFrag" ~ "BlankFrag",
    TRUE ~ CLASS)) |> 
  mutate(CLASS = case_when(
    CLASS == "BlankFrag" & PIECECOMPLETENESS == "Proximal" ~ "Blank", # To add proximal fragments to ratio
    TRUE ~ CLASS)) |> 
  filter(RMTYPE != "INDET") |> 
  filter(CLASS %in% c("Blank", "Core")) |> 
  count(RMTYPE, CLASS, sort = TRUE) |> 
  group_by(RMTYPE, CLASS) |>
  summarise(n=sum(n)) |> 
  spread(CLASS, n, fill=0) |> 
  mutate(sum = rowSums(across(where(is.numeric)))) |> 
  filter(!sum <= 5) |> 
  mutate("Blank/Core" = Blank / Core)

# Cleaning up to create a single table for scatterplot
gravettian_ratiobc_b <-gravettian_ratiobc |>
  filter(`Blank/Core` != "Inf") |> 
  dplyr::mutate("Assemblage" = "Gravettian") |> 
  select(Assemblage, RMTYPE, `Blank/Core`)
proto_ratiobc_b <- proto_ratiobc |> 
  filter(`Blank/Core` != "Inf") |> 
  dplyr::mutate("Assemblage" = "Proto-Solutrean") |> 
  select(Assemblage, RMTYPE, `Blank/Core`)
solutrean_ratiobc_b <- solutrean_ratiobc |> 
  filter(`Blank/Core` != "Inf") |> 
  dplyr::mutate("Assemblage" = "Solutrean") |> 
  select(Assemblage, RMTYPE, `Blank/Core`)
ratio_blankcore <- bind_rows(gravettian_ratiobc_b, proto_ratiobc_b,solutrean_ratiobc_b)

# Scatterplot with local vs non-local RM Types
bc_ratio <- ratio_blankcore |>
  dplyr::mutate(Source = case_when(
    RMTYPE == "T1" | RMTYPE == "T2" | RMTYPE == "T3" | RMTYPE == "T4" | RMTYPE == "T5" ~ "Local",
    TRUE ~ RMTYPE)) |>
  mutate(Source = factor(Source, levels = c("Local", "T6","T7", 
                                        "T8", "T9", "T10", "T11", "TL"))) |>
  ggplot(aes(x=Assemblage, y=`Blank/Core`, fill = Source)) +
  geom_point(size=3, shape = 21, colour = "black") +
  coord_cartesian(clip = "off") +
  theme(legend.position = "none", axis.title.x = element_blank()) +
  scale_fill_manual(values = c("#D49B54", "#8B6969", "#CDAF95", "#2B4F60",
                              "#BDD2B6"))

```

```{r}
#| label: ratiotd

# DS preparation and tool-to-debitage ratio tables
## For Gravettian
gravettian_ratiotd <- phase_dataset |> 
  filter(Level %in% c(6, 7)) |> 
  filter(RMTYPE != "INDET") |> 
  mutate(CLASS = case_when(
    CLASS == "BlankFrag" & PIECECOMPLETENESS == "Proximal" ~ "Blank", # To add proximal fragments to ratio
    CLASS == "RetouchedPieceFrag" & PIECECOMPLETENESS == "Proximal" ~ "RetouchedPiece",
    TRUE ~ CLASS)) |> 
  filter(CLASS %in% c("Blank", "RetouchedPiece")) |> 
  count(RMTYPE, CLASS, sort = TRUE) |> 
  group_by(RMTYPE, CLASS) |>
  summarise(n=sum(n)) |> 
  spread(CLASS, n, fill=0) |> 
  mutate(sum = rowSums(across(where(is.numeric)))) |> 
  filter(!sum <= 5) |> 
  mutate("Tool/Blank" = RetouchedPiece / Blank)

## For Proto-Solutrean
proto_ratiotd <- phase_dataset |> 
  filter(Level %in% c("4E", "4E/5")) |> 
  filter(RMTYPE != "INDET") |> 
  mutate(CLASS = case_when(
    CLASS == "BlankFrag" & PIECECOMPLETENESS == "Proximal" ~ "Blank", # To add proximal fragments to ratio
    CLASS == "RetouchedPieceFrag" & PIECECOMPLETENESS == "Proximal" ~ "RetouchedPiece",
    TRUE ~ CLASS)) |> 
  filter(CLASS %in% c("Blank", "RetouchedPiece")) |> 
  count(RMTYPE, CLASS, sort = TRUE) |> 
  group_by(RMTYPE, CLASS) |>
  summarise(n=sum(n)) |> 
  spread(CLASS, n, fill=0) |> 
  mutate(sum = rowSums(across(where(is.numeric)))) |> 
  filter(!sum <= 5) |> 
  mutate("Tool/Blank" = RetouchedPiece / Blank)

## For Solutrean
solutrean_ratiotd <- solutrean_dataset |> 
  filter(RMTYPE != "INDET") |> 
  mutate(CLASS = case_when(
    CLASS == "Flake" | CLASS == "ElongBlank" | CLASS == "Thinning flake" ~ "Blank",
    CLASS == "FlakeFrag" | CLASS == "ElongBlankFrag" ~ "BlankFrag",
    CLASS == "Retouched piece" ~ "RetouchedPiece",
    CLASS == "Retouched piece fragment" ~ "RetouchedPieceFrag",
    TRUE ~ CLASS)) |> 
  mutate(CLASS = case_when(
    CLASS == "BlankFrag" & PIECECOMPLETENESS == "Proximal" ~ "Blank", # To add proximal fragments to ratio
    CLASS == "RetouchedPieceFrag" & PIECECOMPLETENESS == "Proximal" ~ "RetouchedPiece",
    TRUE ~ CLASS)) |> 
  filter(CLASS %in% c("Blank", "RetouchedPiece")) |> 
  count(RMTYPE, CLASS, sort = TRUE) |> 
  group_by(RMTYPE, CLASS) |>
  summarise(n=sum(n)) |> 
  spread(CLASS, n, fill=0) |> 
  mutate(sum = rowSums(across(where(is.numeric)))) |> 
  filter(!sum <= 5) |> 
  mutate("Tool/Blank" = RetouchedPiece / Blank)

# Creating a single table with all ratios by assemblage for the scatterplot
gravettian_ratiotd_b <-gravettian_ratiotd |> 
  dplyr::mutate("Assemblage" = "Gravettian") |> 
  select(Assemblage, RMTYPE, `Tool/Blank`)
proto_ratiotd_b <- proto_ratiotd |> 
  dplyr::mutate("Assemblage" = "Proto-Solutrean") |> 
  select(Assemblage, RMTYPE, `Tool/Blank`)
solutrean_ratiotd_b <- solutrean_ratiotd |> 
  dplyr::mutate("Assemblage" = "Solutrean") |> 
  select(Assemblage, RMTYPE, `Tool/Blank`)
ratio_tooldebitage <- bind_rows(gravettian_ratiotd_b, proto_ratiotd_b,solutrean_ratiotd_b)

# Scatterplot with local vs non-local RM Types
td_ratio <- ratio_tooldebitage |>
  dplyr::mutate(Source = case_when(
    RMTYPE == "T1" | RMTYPE == "T2" | RMTYPE == "T3" | RMTYPE == "T4" | RMTYPE == "T5" ~ "Local",
    TRUE ~ RMTYPE)) |>
  mutate(Source = factor(Source, levels = c("Local", "T6","T7", 
                                        "T8", "T9", "T10", "T11", "TL"))) |>
  ggplot(aes(x=Assemblage, y=`Tool/Blank`, fill = Source)) +
  geom_point(size=3, shape = 21, colour = "black") +
  theme(legend.position = "bottom", axis.title.x = element_blank()) +
  scale_fill_manual(name = "Chert type", values = c("#D49B54", "#8B6969", "#CDAF95", "#2B4F60",
                              "#BDD2B6", "#BDC7C9", "#798777"))

```

The results are presented following the analysis parameters, focusing on the comparison between wider chert groups (local and non-local cherts) and between assemblages. A complete description of the assemblages and detailed tables for each analysis presented in this study can be found in the supplementary materials (SOM ++).

In all assemblages, blanks and blank fragments are the most frequent class of lithic artefacts and in all chert types (\>40% of the assemblages). Cores are, as expected, found in smaller percentages in all assemblages (\~3-8%). Cores are present in local cherts in larger numbers than in non-local types (P2); their presence is noted in almost all non-local cherts in all assemblages, except for the TL group. In the Proto-Solutrean assemblage however, non-local chert core presence is small and limited to T7-9 (n=4 complete cores and n=2 core fragments). Albeit in very small numbers in all assemblages (n\<10), core preparation and maintenance products (P3) are also present in local and non-local cherts, especially in the non-local types which show the larger sample number such as T6-7. The presence of knapping by-products such as shatter is also seen in both local and non-local cherts in the Gravettian and Proto-Solutrean assemblages. Retouched tools (P1) were identified in all chert types from all studied assemblages; in general, all assemblages show a similar pattern where local cherts show smaller percentages of retouched tools than non-local cherts. However, the assemblages show clear differences in the number of retouched tools.

```{r}
#| label: fig-general-graphs
#| fig-cap: Class by chert type in the Gravettian (a), Proto-Solutrean (b) and Solutrean (c) assemblages. Labels within the plots correspond to the number of artefacts within each class. Only labels of n>3 are shown.

ggpubr::ggarrange(barplot_gravettian, barplot_proto, barplot_solutrean, labels = c("a", "b", "c"), nrow = 3, common.legend = TRUE, legend = "bottom")

```

The Gravettian assemblage shows higher percentages of retouched tools (\~21%) than the other assemblages (\<10%). Detailed tables with tool typology and counts by chert type and assemblage can be found in the SOM (tables +++). Tool diversity (P8) is higher in non-local cherts in the Gravettian assemblage, although with high frequency of less specialised tools such as notches and retouched tools, alongside hunting implements such as backed bladelets (P9). The high frequency of burins seen in this assemblage may be related to their use as cores, representing a knapping strategy more than the presence of retouch. In comparison to the Gravettian, other assemblages show smaller numbers of retouched tools. While in the Proto-Solutrean no pattern was identified between local and non-local retouched tools, in the Solutrean assemblage both tool diversity (P8) and tool specialization (P9) are higher in local cherts.

The relation between blank and core numbers was explored through a blank-to-core ratio (P7; Figure 1 and table s++). In all assemblages, local cherts have generally smaller ratios than non-local cherts, although sample sizes for cores are variable (graph ++). For the Gravettian assemblages, the results show that non-local cherts show ratios above 7 (with the exception of T10), while local cherts have ratios located below 4. The Solutrean assemblage also shows higher ratios for non-local cherts (\>12), with local cherts showing ratios below 7. The Proto-Solutrean assemblage has most blank-to-core ratios below 10, except for non-local T7. However, non-local cores are poorly represented within the assemblage (table ++).

```{r}
#| label: fig-ratios
#| fig-cap: Plotted ratios of blanks-to-core (a) and tool-to-debitage (b) by assemblage (Gravettian, Proto-Solutrean and Solutrean) and by chert type. All local cherts were grouped in a single category "Local", while non-local cherts maintained their individual types.

# Extract legend from plot B using ggpubr function since plot B has more categories than plot A
legend_b <- as_ggplot(get_legend(td_ratio))  # Convert legend to a ggpubr-compatible plot
td_ratio <- td_ratio + theme(legend.position = "none")
ggpubr::ggarrange(bc_ratio, td_ratio, legend_b, labels = c("a", "b", ""), ncol = 1, heights = c(3, 3, 1))

```

Retouched tools were further explored through the tools-to-debitage ratio (P5; Figure 2 and table s++). In general, the result show that non-local chert types have higher retouch-to-debitage ratios than local types, albeit with differences between assemblages. The Gravettian assemblage shows the highest tool-to-debitage ratios compared to the remaining assemblages; non-local cherts show ratios above 0.9, while local cherts show values below 0.5. In the Proto-Solutrean non-local cherts show ratios between 0.3 to 0.5, while local cherts show ratios below 0.3. This pattern is less clear in the Solutrean assemblage since the ratios are the lowest of all assemblages. Non-local cherts show ratios above 0.1 (with exception of T8) while local cherts show ratios below 0.1 (with exception of the local chalcedony).

The sizes of blanks (P4) and cores (P6) are explored through scatterplots of width and length (Figure 3 a) and boxplots for weight (Figure 3 b); complete tables with descriptive statistics and non-parametric statistical test results can also be found in SOM ++, table s++. The scatterplots show different patterns in the several analysed classes.

```{r}
#| label: fig-gravettian-boxplots
#| fig-cap: Boxplots Gravettian

ggpubr::ggarrange(gravettian_scatter, gravettian_stats_weight, labels = c("a", "b"), nrow = 2, common.legend = TRUE, legend = "bottom")

```

```{r}
#| label: fig-proto-boxplots
#| fig-cap: Boxplots Proto-solutrean.

ggpubr::ggarrange(proto_scatter, proto_stats_weight, labels = c("a", "b"), nrow = 2, common.legend = TRUE, legend = "bottom")

```

```{r}
#| label: fig-solutrean-boxplots
#| fig-cap: Boxplots Solutrean.

ggpubr::ggarrange(solutrean_scatter, solutrean_stats_weight, labels = c("a", "b"), nrow = 2, common.legend = TRUE, legend = "bottom")

```

In the Gravettian assemblage, non-local chert blanks (P4) are smaller than local chert blanks, especially regarding length (\~ \<25 mm) and weight (\<5 gr), with statistically significant differences (p value of 0.00009\*\*\* and 0.012, respectively). The local chert blanks, although mostly concentrated below 25 mm width and length and with weights below 5 gr, have the largest number of outliers and variability in terms of size. The same patterns can be seen in the Proto-Solutrean assemblage, where length and weight also show statistically significant differences between chert types (0.046\* and 0.004), with non-local types showing smaller values. In comparison, in the Solutrean assemblage, only non-local chert blank length seems to show statistically significant smaller values (p value of 0.0005\*\*) than local chert blanks, being mostly concentrated below \~30 mm, while local chert blank lengths are more variable. While width seems to be more variable in both local and non-local chert blanks, the statistical analysis shows that non-local chert width is significantly higher than local chert blanks (p value of 0.02).

Regarding cores (P6), the differences in sizes and weights seem between local and non-local cherts seem to be less obvious than those observed in blanks. In the Gravettian assemblage, there is a cluster of non-local chert cores below the 25 mm width and length, while in general, local chert cores seem to be more variable. Especially regarding weight, T6 cores (non-local) show lighter cores (\~12 gr means) compared to local cherts. In the Solutrean assemblage, weight is the only measurement where differences can be seen between local and non-local chert cores; similarly to the Gravettian assemblage, T6 cores show slightly smaller cores (\~18 gr means) than local cherts (\~22 gr means). Despite these differences, the statistical tests applied to the dimensions between local and non-local chert cores show no statistically significant differences between the groups (p \> 0.05). The Proto-Solutrean assemblage shows a small sample of non-local chert cores (n=4), not allowing a clear identification of patterns between the groups; alike the other assemblage however, local chert cores show a high range of sizes (\~15-50 mm width and length) and weights (\~3-85 gr).

Following the analysis parameters previously described, the summarised results for each parameter can be found in @tbl-results-sum, and can be summarised as follows:

In the Gravettian assemblage, retouched tools (P1) are present in higher frequencies in the non-local cherts, as well as in core preparation and maintenance products (P3). Cores are present in even in non-local chert types (P2). Debitage sizes (P4) show smaller sizes and weights for non-local cherts. Tools-to-debitage ratios (P5) are significantly higher in non-local cherts. Core sizes (P6) are slightly smaller in T6, a non-local chert, and the blank-to-core ratios (P7) are higher in non-local cherts. Tool diversity (P8) is higher in non-local cherts, although with high frequency of less specialised tools such as notches and retouched tools, alongside hunting implements such as backed bladelets (P9). The high frequency of burins seen in this assemblage may be related to their use as cores, representing a knapping strategy more than the presence of retouch.

The Proto-Solutrean assemblages show a smaller presence of retouched tools than the Gravettian, and within the assemblage, retouched tools (P1) are slightly more frequent in non-local cherts. Cores of non-local chert types are found in very small numbers (P2), although knapping is likely occurring on site. Core preparation and maintenance products (P3) are only present in non-local cherts, albeit in very small numbers (n=2). Blank sizes (P4) and core sizes (P6) are slightly smaller in non-local cherts. Regarding the ratios, tool-to-debitage ratios (P5) are higher in non-local cherts, albeit smaller than those seen in the Gravettian assemblage, and blank-to-core ratios (P7) are also higher in non-local cherts. Little differences were observed in tool diversity (P8) and specialisation (P9) between local and non-local cherts.

Finally, the Solutrean shows no relevant differences in the frequencies of retouched tools (P1) and core preparation and maintenance products (P2) between local and non-local cherts, with only slightly higher frequencies in the non-local cherts. In general, the retouch frequency is lower than that observed in the previous assemblages. Cores are present in relevant quantities in non-local chert types (P2). Debitage (P4) mass is slightly smaller in non-local cherts, although with larger widths. Core (P6) sizes show slightly smaller values for T6. Similarly to the Proto-Solutrean, tools-to-debitage ratios (P5) and blank-to-core ratios (P7) are slightly higher in non-local cherts. Both tool diversity (P8) and tool specialization (P9) are higher in local cherts.

```{r}
#| label: tbl-results-sum
#| tbl-cap: "Summarised results for analysis parameters between grouped chert types (local and non-local) by assemblage." 

p_results <- readr::read_csv(here::here('analysis/data/tables/results_sum.csv'))

knitr::kable(p_results)

```

# Discussion

The results of the study align with our initial expectations, providing insights into mobility patterns, raw material use, and technological strategies throughout the Upper Paleolithic (UP) in southwestern Iberia. We initially anticipated differences in core reduction between local and non-local resources (Table ++, expectations a-b). However, these differences are influenced by the transportation strategies used to bring non-local cherts to Vale Boi. The presence of non-local chert cores at the site depends on whether these materials were transported as finished tools or blanks—likely part of an individual provisioning strategy (Kuhn, 2004)—or as trimmed cores or larger stone volumes, as seen in site provisioning strategies (Kelly, 1988; Roth & Dibble, 1998; Clark, 1987; Kuhn, 2004).

Our findings indicate that cores were present in non-local chert groups across all studied assemblages, albeit in small numbers (e.g., in the Proto-Solutrean assemblage). While the smaller fraction of the assemblages—such as chips, which can serve as proxies for on-site knapping—was not analyzed, other knapping by-products, including shatter in non-local chert types (except in the Solutrean assemblage, where this category was not studied; see Section ++ Materials and Methods), as well as core preparation and maintenance products, may also serve as indicators of core transportation and on-site knapping.

These findings suggest a strategy of transporting cores or nodules to Vale Boi, followed by on-site knapping for most non-local chert types. However, an exception appears in the case of certain TL cherts (TL2-6, TL9-10, TL14; Table S13). These artifacts, whose source remains unknown but do not match local cherts, lack both cores and associated knapping debris. This pattern suggests that these TL cherts may represent an instance of long-distance individual provisioning (Kuhn, 2004), where materials were transported as finished tools or blanks.

The presence of cores and evidence of on-site knapping enabled a comprehensive comparison of knapping strategies—specifically, the degree of preparation and maintenance through maintenance products—as well as knapping intensity between local and non-local cherts.

Our analysis identified core preparation and maintenance products in the studied assemblages, suggesting a possible effort to preserve raw material volume. However, these products were found in low percentages across all assemblages and chert types (\<4% and n\<7). This indicates that, at Vale Boi, core preparation and maintenance products may not serve as reliable proxies for distinguishing between chert types. Instead, their presence may be more closely linked to specific knapping strategies and objectives, such as prioritizing the production of blades and bladelets.

Core and blank sizes and ratios yielded better results. Our findings suggest that non-local cherts underwent more intensive reduction than local cherts, as evidenced by the higher blank-to-core ratio and the statistically significant smaller size and weight of blanks made from non-local cherts. These results align with previous studies, which propose that the intensive reduction of cores—manifested in smaller core sizes, smaller debitage products, and a higher amount of debitage per core—may be linked to lower mobility. In this context, lower mobility results in reduced access to non-local raw materials, which are therefore more intensively reduced and eventually replaced by local raw materials (Kuhn, 2004; Roth & Dibble, 1998; Grove et al., 2023; Surovel, 2009). However, our results show that these differences are not limited to long-term occupations and low mobility. High blank-to-core ratios and smaller blank sizes in non-local cherts are also observed in the Gravettian occupation, previously interpreted as a short-term occupation which frequent moves (Cascalheira ++; Belmiro et al., 2025). Due to this, we may interpret that non-local raw materials were more intensively reduced than local cherts throughout all the UP, independent of the duration of the occupation.

In contrast to blanks, cores exhibited small, though statistically non-significant, differences in size and weight between local and non-local cherts. These results may be explained by a combination of factors, including the availability of local lithic resources, transport, and knapping strategies focused on the intensive reduction and maintenance of non-local raw materials. Belmiro et al. (2023) highlight that chert nodules in the Algarve region vary between \~5-10 cm, with a maximum diameter of 20 cm. Although these nodules are abundant and likely accessible throughout the Upper Paleolithic, given their location in accessible cliffs, they tend to be small and prone to fracture when extracted directly from the source. Given the initial size of local chert nodules, it is possible that the small core sizes are not the result of intensive knapping, but rather reflect the initial size of the knapped volumes.

In comparison, cherts from central Portugal—the probably source from T6 cherts from Vale Boi—can be found in larger volumes (\>20 cm), although smaller nodules are also present. This suggests that the small artifact sizes associated with this non-local resource are not necessarily due to limited resource availability, but rather an intentional choice. This decision may involve the transportability of smaller volumes or nodules, knapping strategies focused on intensive reduction and maintenance, or a combination of both. This is further supported by the higher blank-to-core ratio observed in non-local raw materials, particularly T6. It may also explain the more frequent occurrence of heavier and larger outliers in local chert cores, compared to the relatively rare occurrence of larger outliers in non-local types (T6-7).

The intensity of reduction and maintenance discussed thus far can also be inferred from the frequency and diversity of retouched tools. In fact, retouched tools are often key elements used in the literature to distinguish between differential use of local and non-local raw materials. Our results align with expected outcomes, as non-local cherts exhibit higher frequencies of retouched tools and higher tool-to-blank ratios across all assemblages. This supports the idea that non-local raw materials were actively procured and that greater effort was invested in tool production (Andrefsky, 1994; Perlès, 1992; Kelly, 1988) and the maintenance of existing artifacts through retouch (Kuhn, 2004).

While the intensity of retouch aligns with the expected outcomes (Table ++, expectations 1c and 2c), tool diversity and typologies (Table ++, expectations 1d and 2d) differ from what was anticipated. It was expected that non-local cherts would show lower typological diversity, as the distance to the source and inferred mobility suggest that less specialized tools (e.g., retouched blanks) would be more suitable for various use-case scenarios (Shott, 1986; Odell, 1981; Siegel, 1984).

However, with the exception of the Solutrean assemblage, our results show higher tool diversity in non-local cherts in the Gravettian assemblages, and similar tool diversity between chert types in the Proto-Solutrean assemblages. This suggests that tools were transported as either less specialized tools or blanks, which were then maintained on-site. Our results indicate that long-distance raw materials, particularly T6 and T7, were likely knapped at the site. Therefore, the high diversity in tool typology may reflect the transportation of raw material volumes and their subsequent knapping on-site, coupled with a possible preference for these materials in the production of retouched tools, contributing to their high typological variability.

Despite this high variability, less specialized tools, such as retouched blanks, remain predominant in non-local cherts across all assemblages. Specialized tools (e.g., backed tools during the Gravettian occupation) are also present, supporting the interpretation that, due to the likely ease of access to these raw materials—either through high mobility or exchange between groups—these materials were knapped on-site. However, they were characterized by longer use-lives, extensive reduction, and a high presence of retouch, with a predominance of non-specialized formal tools.

While the patterns identified so far have established a clear distinction in the use and maintenance of local and non-local resources, it is also important to discuss the possible reasons for the varying abundance and technological patterns of non-local raw materials throughout the Upper Paleolithic at Vale Boi, as well as the factors behind the differences observed across the different technocomplexes.

Previous research has often focused on the concepts of abundance and quality in the procurement and use of non-local lithic resources over local ones to explain differences in proportion, use and maintenance. In this context, the scarcity or low quality of local resources would drive the procurement of non-local materials and require more effort in preparing transportable cores and producing tools (Andrefsky, 1994; Perlès, 1992; Kelly, 1988). However, quality may become a less significant factor when non-local raw materials are easily accessible (Akerman et al., 2002; Torrence, 1996; Brown, 1999; Oestmo, \*\*\*). Even in the presence of high-quality local materials, effort was still invested in transporting non-local resources (Roth & Dibble, 1998).

Regarding Vale Boi, quality does not appear to be a defining factor in raw material choice, as typologies typically associated with high-quality lithic resources are also present in other materials. For example, Solutrean bifacial tools and points were produced using local chert, which may be considered lower quality than Rio Maior Cretaceous chert due to its coarser texture and less homogeneous composition. This suggests that the choice of raw material was not solely dependent on quality.

Similarly, Vale Comprido points, a fossil indicator of the Proto-Solutrean, were primarily made from other lithic resources (e.g., dolerite), with only two identified points made of chalcedony and chert (Belmiro et al., 2021). This further supports the idea that raw material choice was not strictly based on quality, as these points were made from a variety of materials, including those less commonly associated with formal tools at the site.

In this case, the impact of raw material quality seems to be more related to the differences between lithological groups, which have varying textures and breakage patterns (e.g., between greywacke and chert), rather than within micro-cryptocrystalline quartz resources like chert. This distinction suggests that raw material characteristics, such as texture and fracture properties, may have played a more significant role in tool production than raw material quality alone.

Finally, a visual inspection of a cache found in the Shelter area attributed to the Gravettian revealed a high frequency of backed bladelets made from both local and non-local cherts. This observation further emphasizes the use of diverse raw materials, regardless of their quality.

Therefore, it is not necessarily the case that non-local cherts were procured for their quality or because local cherts were unsuitable. Instead, their presence may reflect mobility strategies, territorial exploitation, and social networks that facilitated the introduction of long-distance cherts into the technological practices of southwestern hunter-gatherer groups. These non-local materials were used and maintained differently, possibly due to their initial size or the need for conservation, given their more restricted or higher-cost acquisition compared to local cherts.

These mobility strategies, territorial exploitation, and social networks also help explain the distinct patterns of non-local raw material use observed between the Gravettian and other assemblages. One key difference is the high frequency of non-local cherts in the Gravettian assemblage at Vale Boi, which make up approximately 50% of the chert assemblage (Belmiro et al., 2025). When combined with technological data, this also reveals significant differences in the frequency of retouched non-local chert tools and the tool-to-blank ratio (\~30% and \~1, respectively), compared to other technocomplexes (\~15-19% and 0.1-0.5). Several studies have shown that short-term occupations often rely heavily on non-local toolkits and raw materials (Torrence, 1983; Surovell, 2009), and are characterized by higher reduction intensity and increased tool-to-debitage ratios (Grove et al., 2023). These differences support the interpretation of the Gravettian at Vale Boi as a short-term occupation (Belmiro et al., 2025).

This allows us to further expand our knowledge about chert provisioning during the UP at Vale Boi and suggest an overall interpretation for how groups were using and managing their lithic resources through time. In southwesternmost Iberia, the first identified UP occupations are from the Gravettian. At Vale Boi, these occupations appear to correspond to short-term settlements with frequent mobility, where non-local raw materials were transported as cores or nodules and knapped on-site. Alternatively, non-local raw materials were brought in as blanks, which were consistently retouched, although individual toolkits made from limited non-local raw materials—primarily blanks or tools—were also present. Raw material volumes were intensively exploited at the site, yielding both specialized and non-specialized tools. Local raw materials were also used to produce high frequencies of retouched tools, though this was done less intensively. Given the technological differences between the Gravettian Vicentine facies and other regions such as central Portugal and southern Spain (Marreiros et al., ++), we suggest that the approximately 250 km distance between Vale Boi and identified non-local sources reflects raw material exchanges between groups at the edges of their territories, rather than an indication of exploited territory.

These exchanges and patterns of mobility persisted throughout the Upper Paleolithic, though with changes in the mobility and settlement patterns at Vale Boi. Over time, Vale Boi was occupied as a long-term residential site. Proto-Solutrean and later Solutrean groups, while still having access to non-local raw materials, moved less frequently, which limited the influx of these materials. Although non-local raw materials were still intensively exploited and maintained at the site, hunter-gatherer groups increasingly relied on local raw materials. This shift was likely due to the proximity of local sources, which facilitated more frequent use, while non-local materials continued to be exploited and maintained with greater intensity.

# Conclusion

# Acknowledgements

<!-- The following line inserts a page break  -->

\newpage

# References

<!-- The following line ensures the references appear here for the MS Word or HTML output files, rather than right at the end of the document (this will not work for PDF files):  -->

::: {#refs}
:::

\newpage

### Colophon

This report was generated on `r Sys.time()` using the following computational environment and dependencies:

```{r}
#| label: colophon
#| cache: false

# which R packages and versions?
if ("devtools" %in% installed.packages()) devtools::session_info()
```
