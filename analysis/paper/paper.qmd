---
title: "Placeholder for article 3"
author:
  - Jane Doe:
      correspondence: "yes"
      email: janedoe@fosg.org
      orcid: 0000-0003-1689-0557
      institute:
        - fosg
        - fop
  - John Q. Doe:
      institute: fosg
      orcid: 0000-0003-1689-0558
  - Peder Ås:
      institute: fosg
      orcid: 0000-0003-1689-0559
  - Juan Pérez:
      orcid: 0000-0003-1689-0551
      institute:
        - name: Acme Corporation
  - Max Mustermann:
      orcid: 0000-0003-1689-0552
institute:
  - fosg:
      name: Formatting Open Science Group
      address: 23 Science Street, Eureka, Mississippi, USA
  - fop: Federation of Planets
title-block-published: "Last updated"  
date: now
date-format: long
format: 
  docx:
    reference-doc: "../templates/template.docx" # Insert path for the DOCX file
execute:
  echo: false
  warning: false
  message: false
  comment: "#>"
  fig-path: "../figures/"
  fig-dpi: 600
filters:
  - ../templates/scholarly-metadata.lua
  - ../templates/author-info-blocks.lua
  - ../templates/pagebreak.lua
bibliography: references.bib
csl: "../templates/journal-of-archaeological-science.csl" # Insert path for the bib-style
abstract: |
  Text of abstract
keywords: |
  keyword 1; keyword 2; keyword 3
highlights: |
  These are the highlights. 
---

<!-- This is the format for text comments that will be ignored during renderings. Do not put R code in these comments because it will not be ignored. -->

<!-- With the following code you can access and display values from the yml header above. -->

Keywords: `r rmarkdown::metadata$keywords`

Highlights: `r rmarkdown::metadata$highlights`

<!-- The actual document text starts here: -->

```{r}
#| label: library

# Read libraries necessary for running the script
library(readr)
library(dplyr)
library(tidyr)
library(stringr)
library(ggplot2)
library(janitor)
library(ggpubr)
library(knitr)
library(tibble)

```

# Introduction

Lithic technological organisation has long been a central focus in archaeology for the insights it offers into past human behaviour and lifeways. Nelson (1991) defines lithic technological organisation as the selection and integration of strategies for the production, use, transportation, discarding, and management of tools and raw materials. Kelly (1988) describes it as the interplay of space and time in lithic tool production within a cultural system. This includes activities such as raw material sourcing and distribution, tool manufacture, use, reuse, and discard, as well as broader behavioural patterns like mobility and settlement systems. Together, these definitions underscore the multifaceted nature of lithic technological organisation and its utility in examining key aspects of hunter-gatherer adaptations over time.

Raw material procurement is a key aspect of lithic technological organisation, as it played a crucial role in the lives of past hunter-gatherer groups by determing the possibilities for tool production and use (Bamforth & Bleed, 1997). Approaches focused on the study of raw materials provide key knowledge on several topics of hunter-gatherer organisation such as procurement and mobility strategies (Ambrose, 1990; Binford, 1979, 1985; Gould, 1985; Kuhn, 1991; Mccall, 2007), occupation types and their duration (Kuhn, 2004; Surovell, 2009; Grove, 2023), and social networks and exchanges (Whallon, 2006; Gamble, 1999). These approaches focus on the characterisation of geological and archaeological raw materials to identify local and non-local raw materials within an assemblage, their possible sources, and examine their proportions within a site over different occupations and periods.

Similar studies have also been applied to lithic assemblages from prehistoric archaeological sites in the Iberian Peninsula (e.g., Aubry et al. 2016; Aubry and Igreja 2009; García-Rojas et al. 2021; Gómez de Soler et al. 2020; Herrero-Alonso et al. 2020; Matias 2016; Nocete et al. 2005; Ortega 2003; Pereira, Andrade, et al. 2016; Pereira et al. 2021, 2022; Ramacciotti et al. 2022; Rodríguez et al. 2011; Sánchez de la Torre et al. 2023; Soto 2016), and contributed to understanding how different groups explored the available lithic resources, aided in identifying extensive movements and social networks throughout the Upper Palaeolithic (e.g., Aubry et al. 2004, 2016; Corchón Rodríguez et al. 2016; Hermida et al. 2016; Marreiros et al. 2016; Sánchez de la Torre et al. 2023).

Until recently, the study of raw materials in southwestern Iberia was limited, and knowledge about mobility and social networks was limited to technological studies, derived from the archaeological site of Vale Boi. This site is crucial for understanding Upper Paleolithic (UP) adaptations, as it is currently the only site in southwestern Iberia with a long-term occupation spanning most of the UP, enabling the exploration of cultural and technological trends over time (Cascalheira et al. 2017). For example, Vale Boi has provided valuable insights into hunter-gatherer subsistence strategies, technological organisation (Belmiro et al. 2021; Nuno Bicho et al. 2013; Cascalheira et al. 2017; Cascalheira 2019; Horta et al. 2019; Manne et al. 2012; Marreiros et al. 2016). This also contributed to understanding different patterns of territory exploitation and contact with other regions of Iberia throughout the UP.

During the Solutrean period, Vale Boi served as a key connection point between central Portugal and southern Spain, facilitating social networks and cultural exchanges (Cascalheira, 2013; Cascalheira et al., 2017). Proto-Solutrean evidence also indicates technological similarities and close contact with central Portugal (Belmiro et al., 2021). In contrast, studies of Gravettian occupations reveal marked regional differences, suggesting more limited movement of people and information in southwestern Iberia (Marreiros and Bicho, 2013).

Recent research has expanded our understanding of mobility and social networks through lithic raw material studies. Our team’s recent work (Belmiro et al., 2025) identified non-local cherts originating from central Portugal (\>250 km from Vale Boi) and souuthern Spain (\>200 km from Vale Boi). The proportions of these materials varied across the UP, with earlier occupations (Gravettian) showing high frequencies of non-local chert, while later ones (Proto-Solutrean and Solutrean) exhibited a marked decline. These findings suggest the establishment and maintenance of extensive social networks connecting southwestern Portugal to Southern spain and central Portugal as early as the beginning of the UP.

These results, particularly those related to the Gravettian, were interpreted as outcomes of residential mobility rather than direct social network influences, though further investigation is required. While distance to source and raw material proportions offer valuable insights, they represent only one aspect of raw material procurement and management. A raw material-focused approach alone is insufficient for comprehensively understanding mobility patterns and technological organisation. Indeed, numerous studies and models from both ethnographic and archaeological perspectives have demonstrated the complex interplay between lithic technological variability, raw material provisioning, and mobility.

For example, technological variability within a lithic assemblage may be explained by the abundance and quality of raw materials (Andrefsky, 1994; Brown, 1999; Oestmo, 2017). Whenever raw materials in proximity to a residential site are abundant and of good quality, a high percentage of formal tools are produced (Andrefsky, 1994; Perlès, 1992), and artefacts show less reduction intensity and decreased conversation through retouch (Thacker, 2002). Whenever local raw materials are scarce or of low quality, non-local resources are procured to produce mostly formal tools (Andrefsky, 1994; Perlès, 1992). Similarly, when groups move to areas where raw material is scarcer or of poorer quality, more effort is placed into the preparation of transportable cores and the production of tools (Kelly, 1988).

However, the different patterns between local and non-local raw material proportion and use in lithic assemblages may be less obvious whenever prehistoric groups have easy access to non-local raw materials due to high mobility or exchanges between groups (Akerman et al., 2002; Torrence, 1996; Brown, 1999; Oestmo). Furthermore, Roth and Dibble (1998) demonstrate that even in areas where good quality raw material is abundant, non-local raw materials were still transported to the site, often in the form of large blanks or trimmed cores, and both local and non-local raw materials were retouched into tools.

Tools, flakes and cores often functioned as portable sources of raw material within mobile toolkits or during non-local raw material procurement, enabling stone knapping during periods of limited time or in environments with scarce or unsuitable materials (Kelly, 1988; Morrow, 1996; Gould et al., 1971; Kuhn, 1994; Perlès, 1992; Shott, 1986). For example, the transport of formal cores (e.g., blade cores) and bifaces used as cores have been interpreted as lightweight and reconfigurable raw material storage strategies (Clark, 1987; Kelly, 1988).

Formal tools and the degree of tool maintenance have also been associated with planned preparation, efficient use, and transportability, reflecting their connection to mobile settlement strategies, short-term site occupations (Torrence, 1983) and the regional distribution of raw materials (Bamforth, 1986). For example, non-local raw materials, transported as part of personal toolkits (frequently associated with residential mobility), would primarily arrive at sites as retouched pieces (Kuhn, 2004). These artefacts would show higher degrees of reduction and reworking (Kuhn, 2004) and a higher percentage of non-cortical flakes (Roth and Dibble 1998), as they would have been in use for an extended period before being discarded. When knapped on-site, non-local materials also tend to exhibit higher proportions of retouched tools compared to local materials.

Tool variability and size are also impacted by mobility and uncertainty regarding raw material availability; increased group mobility may create a pattern of limited tool variability, and tools may become less specialised and easily reconfigurable, such as retouched blanks (Shott, 1986; Odell, 1981; Siegel, 1984). Increased mobility also often results in smaller tools (Shott, 1986), although other authors have noted that large tools may be well-suited to a mobile lifestyle due to their extended use-life, allowing them to remain functional in areas where raw materials are scarce or unsuitable for knapping (Morrow, 1996).

The proportions of local vs non-local raw materials discussed thus far have focused greatly on group mobility, which is linked with residential mobility and occupation duration. Residential mobility (e.g., foraging range size and frequency of residential moves) is a defining characteristic of hunter-gatherer societies and plays a central role in their lifeways (Kelly, 1995). It is a key factor driving changes in lithic assemblages (Brown, 1999; Oestmo, 2017; Roth & Dibble, 1998) as it significantly impacts the cost and use of artefacts and raw materials since they affect the relation between the distance of raw material sources to sites (Kuhn, 2004). As such, different raw material and technological patterns have been observed between short-term and long-term occupations.

Short-term occupations typically rely on transported (non-local) toolkits (Torrence, 1983) and raw materials (Surovell, 2009), show higher reduction intensity, and an increased tools-to-debitage ratio in the assemblages (Grove et al., 2023). Long-term occupations, typically rely on provisioning sites with locally available and suitable raw materials, while non-local materials are gradually used and discarded (Grove et al., 2023; Surovell, 2009). Non-local raw material cores are highly reduced and extensively exploited (Kuhn, 2004; Roth & Dibble, 1998) and exhibit higher blank-to-core ratios (Roth & Dibble, 1998).

These studies highlight significant variability in lithic assemblages and raw material proportions, reflecting different facets of hunter-gatherer technological organisation. This variability appears between behaviourally and ethnically similar sites (Bamforth, 1986), across distinct chrono-cultural periods, and even within a single site among various raw materials. To fully understand past hunter-gatherer behaviours, organisation, and lifeways, it is crucial to examine all stages of lithic production—procurement, distribution, use, maintenance, and discard—through interconnected approaches that combine lithic technology and raw material analyses.

Building on the studies mentioned above and existing (yet currently uncorrelated) data on UP lithic technology and raw material analyses at Vale Boi, we outline the expectations and objectives for the current study.

## Aims

Our goal is to understand the provisioning, use and management strategies of chert lithic resources of the hunter-gatherer groups of Vale Boi during the Upper Paleolithic. We focus on the technological characteristics of the two broader groups of cherts identified at the site: local and non-local, based on the notion that local raw materials will show technological patterns different from those which are non-local. Expanding upon our previous works on chert types present throughout the UP sequence in the Terrace and Shelter area of Vale Boi, and their possible interpretations, and following the previously mentioned studies and models about raw material management and lithic technology organisation focusing mainly on the different management of local and non-local raw materials, associated with mobility and occupation length, we derive two main expectations (fig. 1):

1.  Local raw materials are expected to present a) low use-lives, with knapping strategies characterised by manufacture, use and discard; b) a decreased reduction intensity and low tools to debitage ratio; c) larger cores and lower blank-to-core ratio; d) less extensive reduction and reworking of tools; e) higher tool typology diversity. This may be related to the abundance of local raw materials which leads to less intensive life-use extension, but also to the residential characteristics of the site and low mobility, which increases the reliance on local raw materials.

2.  Non-local raw materials are expected to present a) a majority of formal tools, in the case of individual provisioning or higher use-lives, with knapping strategies characterised by the manufacture, use and maintenance; b) an increased reduction intensity and high tools to debitage ratio; c) smaller cores and higher blank-to-core ratio; d) more extensive reduction and high presence of retouch and/or tool maintenance; e) lower tool diversity, characterised by less specialised tools, such as the presence of retouched blanks as multipurpose tools. This may be related to scarcer or poorer quality of raw materials which leads to the prepared transportation of lithic resources to a site, but also related to more mobile settlement patterns as well as short-term site occupations.

```{r}
#| label: tbl-expectations
#| tbl-cap: A table.

hypotheses <- readr::read_csv(here::here('analysis/data/tables/hypotheses_short.csv'))

knitr::kable(head(hypotheses))

```

Despite these expectations, it is important to notice that, especially in occupations with a high percentage of non-local cherts at the site (e.g., Gravettian occupations of level 7 and 6 of the Terrace at Vale Boi), these technological may not reflect a preoccupation with intensive management of a scarce and limited non-local resource, and be more a reflection of the type of provisioning applied following the suggested model by Kuhn (2004). In this sense, distance from source may have had little intrinsic meaning in the past, especially regarding non-local raw materials. There are several ways in which raw materials may be transported to a site, and the relationship between distance and cost may vary depending on how this takes place [@kuhn2004]. When non-local raw materials are as abundant as local ones, the difference in the technological organization between these materials may be less obvious (Andrefsky, 2004).

## Site descriptions

Vale Boi is situated on the western coast of the Algarve region in southern Portugal, within a small valley that stretches southward to the Atlantic coast, approximately 2 km away. The site is bordered by limestone outcrops, which form rock shelters facing west and southwest. Covering more than 10,000 square meters along the valley slope, Vale Boi includes three main excavated areas: Slope, Terrace, and Shelter, which were excavated between 2000 and 2019 (Bicho et al., 2007, 2012, 2013; Cascalheira et al., 2017; Cascalheira & Bicho, 2013; Manne et al., 2012). Based on the available raw material and technological data, particularly the macroscopic and petrographic research (Belmiro et al., 2025), the Terrace and Shelter areas were selected for the current study.

The Terrace spans occupations from the UP to the Early Neolithic. Although excavations began in 2000, a new 8-square-meter area was opened in 2012 to better understand the stratigraphic sequence and assess the potential presence of older cultural layers, which could be linked to an early Upper Paleolithic occupation. Between 2012 and 2016, eight primary litho-stratigraphic units were identified. The UP sequence includes multiple occupations, spanning \~10,000 years: Gravettian (levels 8 to 6) between approximately c. 32 and 27 ka cal BP, Proto-Solutrean (levels 5 to 4E) between approximately c. 26 and 24 ka cal BP, and Solutrean (levels 4D, 4C, 4, and Lower 3) between approximately c. 24 and 20 ka cal BP (Belmiro et al., 2021; Cascalheira et al., 2017; Cascalheira & Bicho, 2013).

The Shelter area contains four main lithostratigraphic units, with occupations from the Magdalenian, Solutrean, and Gravettian periods. The Magdalenian and Gravettian levels (Z and D, respectively) were partially eroded, while the Solutrean levels represent the most intensive occupation, with three well-preserved archaeological horizons (layers C to A), dated to approximately c. 24-22 ka cal BP. These occupation levels were found beneath blocks of limestone that likely collapsed from the rockshelter ceiling, probably shortly after the Last Glacial Maximum (Cascalheira, 2010; Cascalheira et al., 2017).

Most of these occupations resulted in large lithic assemblages, encompassing all lithic production stages and use of several raw materials, often for specific uses. Research on the lithic assemblages of the site have allowed the technological and cultural characterisation of human groups occupying the site, which show some differences through the different UP occupations. Given the chosen sample for this study (see section 2 “Materials and methods”), we summarise here the results for the technological analysis of the Solutrean assemblages (levels A-C) of the Shelter (Cascalheira, 2010; Cascalheira et al., 2013) and the Proto-Solutrean assemblages (levels 4E-5) of the Terrace (Belmiro, 2020; Belmiro et al., 2021). The Gravettian occupations (Levels 6-8) of the Terrace have been recently studied, but the results remain unpublished.

The lithic analysis of the Shelter Solutrean levels (A-C) shows a high number of lithic artifacts, with over 22 000 artifacts analysed (including chips which correspond to \~60% of the assemblage and shatter \~17-19%). The volumes introduced into the site were mostly cortical, given the high frequencies of cortex in blanks and retouched tools. The knapping strategies are dominated by unidirectional and bidirectional prismatic, with frequent core maintenance products. Flakes dominate the debitage assemblage, and endscrapers, notches, splintered pieces and retouched blades/flakes are the most common retouched tools. Stemmed and winged points, laurel leaves, shouldered points and parpalló points were also identified (Cascalheira et al., 2013).

The Proto-Solutrean horizons yielded more than 26,500 artifacts (including chips which correspond to \~65-70% of the assemblage and shatter \~20%), \~11,000 attributed to the lower bottom of level 5 and \~15,600 attributed to the top of level 5 and level 4E. Both horizons are characterised by knapping strategies dominated by unidirectional prismatic cores, with little platform preparation, focused on the obtention of bladelets (in bottom level 5) and flakes. Retouched tools are dominated by splintered pieces, endscrapers and retouched blanks, with Vale Comprido points (the Proto-Solutrean fossil director) being barely inexistent in chert and mostly produced in dolerite (Belmiro et al., 2021).

Previous studies showed that the main raw materials used at the site are chert, quartz and greywacke, with the percentages of these changing between occupations. For example, while studies show a high degree of quartz in the lower Proto-Solutrean levels (Belmiro et al., 2021), in the Solutrean occupations of the Shelter a dominance of chert was observed (Cascalheira, 2010). Similarly, different raw materials have been observed to play specific roles, such as the case of chert for the production of a high percentage of blanks and retouched tools. While quartz and greywacke can be found locally, in the streams and adjacent to the site, chert sources are further away, although still within a \~20 km radius of the site. Our previous study showed, as expected, the existence of local chert in the assemblages, originating from the Lower Jurassic outcrops in proximity to the site (Belmiro et al., 2025). As previously mentioned, a portion of non-local cherts was also identified, with some identified sources, such as the Cretaceous outcrops of Central Portugal (Lisbon and Rio Maior areas) and the Upper Jurassic oolitic/peloidal cherts of the Betic Systems in southern Spain. This suggests contacts or long-range mobility patterns of the groups occupying Vale Boi all throughout the UP, although in different degrees, possibly related to changes in the settlement patterns and duration of site occupation.

Both these areas have been previously interpreted as seasonal residential camps, repeatedly used for extended stays, due to the abundance of lithic debitage, stone tools, heat-cracked rocks related to grease rendering activities, large quantities of faunal remains (both marine and terrestrial) and the presence of ornaments and portable art [@manneIntensiveSubsistencePractices2012]. This is true for most of the occupations (levels), with exception of the Early Gravettian occupations of the Terrace area and Magdalenian occupation of the Shelter.

Using the Whole Assemblage Behavioral Index (WABI), previously used in other studies (Riel-Salvatore, 2010; Riel-Salvatore & Barton, 2004), Cascalheira et al., (2017) used the lithic results from the Shelter Solutrean levels (Cascalheira, 2010; Cascalheira et al., 2013) and Magdalenian levels (Mendonça, 2009), and the Gravettian levels of Terrace (Marreiros et al., 2015) to reconstruct and compare the mobility strategies of the several occupations, through the lithic volumetric density and the frequency of retouched tools. This method allowed the confirmation that, except from the Early Gravettian and Magdalenian occupations, all other occupations are composed of high-density assemblages with low degree of retouch, correspondent to a residential base-camp occupation, for extended periods of time. Regarding the Terrace area, however, the results were based on previous excavations (\<2012), and the identification of new layers and reorganization of the occupations is yet to be tested through the use of lithic techno-typological methods.

A similar conclusion was suggested based on the interpretation of the chert sourcing and proportions in the several UP occupations of the Terrace and Shelter of Vale Boi, and following other models relating local/non-local raw materials with mobility (Grove et al., 2023; Surovell, 2009). The high proportions of non-local chert (\~50%) in the Gravettian occupations (levels 6 and 7), and gradual reduction in the following occupations, were interpreted as a possible result of settlement changes, where the Gravettian occupations corresponded to short-term occupations, and the other occupations corresponded to residential, long-term occupations with more infrequent moves (Belmiro et al., 2025).

# Materials and methods

The current study includes the statistical correlation between the techno-typological analysis and the geoarchaeological study of the chert lithic assemblages of the UP of Vale Boi. As mentioned above, previous studies have individually analysed the lithic assemblages from Vale Boi focusing on different subjects and methods, obtaining different kinds of data. Specifically, our previous study focused on the macroscopic and petrographic characterisation of cherts, and the identification of distance to sources and proportions through the several UP technocomplexes. This study provided the basis for understanding which cherts were being used at the site, where they were coming from and how/why their use became more or less intense. In that same study, we used previously known data related to settlement type and seasonality to contextualise the changes in chert sources and proportions through time, to better understand the possible strategies of raw material procurement (Hahn, 2002). However, and as mentioned in Belmiro et al. 2025, correlating the obtained data with technological analysis data provides a key step to better understand how these raw materials were being introduced into the site and used, through the correlation with data such as type of lithic class, since it may point towards the specific mobility of artifacts (Hahn, 2002).

This is especially relevant in a site like Vale Boi, where several technological studies have been key to understand the cultural characteristics of the groups inhabiting throughout the UP, and their possible relations within the UP in Iberia. By using previously acquired data, it becomes possible to integrate different datasets to provide a wider picture of UP occupations at Vale Boi, and using the potential of lithics to inform us of hunter-gatherer lifeways.

As such, this study includes datasets which have been previously interpreted and published, most of which can also be found in online repositories and freely consulted. As previously mentioned, the macroscopic and petrographic data of cherts was previously collected and published by our team (Belmiro et al., 2025), and can also be found in an online repository (OSF\*\*). This study focused on the UP chalcedony and chert assemblages of Vale Boi, especially the Gravettian (levels 6 and 7), Proto-Solutrean (levels 4E and 5) and Solutrean (levels 4 to 4D) from the Terrace area and the Solutrean (levels A to C) from the Shelter area. The methodology used in the study, and supporting documents, including the chert type characterisation and analysis data dictionaries can be found in the article and the online repository.

The technological analysis datasets have been collected by our team and published in previous works. The Solutrean assemblage technological analysis was published by Cascalheira (-Cascalheira, 2010), as part of a Master’s thesis and following publications, with the study of levels A to C of the Shelter area. The dataset used for this study was not originally published, but can be consulted in our online repository (++). Given the inexistence of technological studies for the Solutrean levels of the Terrace with a representative amount of lithics (level 4), the Solutrean analysis in this study is limited to the Shelter area. However, and as seen in Belmiro et al. (2025), the raw material patterns seem to show little differences between the Solutrean in both areas, thus coupled with the similar radiocarbon dates between area (c. 24-22 and 24-20 ka cal BP), we assume that they are representative of similar, long-term, residential occupations which aptly characterise the Solutrean groups of Vale Boi. The Proto-Solutrean technological analysis was the result of a Master’s thesis (Belmiro, 2020) and following publication (Belmiro et al., 2021), with the study of levels 4E and 5 of the Terrace area. The dataset used for this study can be consulted in the original online repository (++), as well as in our RStudio reproducible project, available in our online repository (\*\*). Finally, the Gravettian technological analysis was the result of a recent and unpublished study, focusing on the study of levels 6 and 7 of the Terrace area. This dataset can also be found in our online repository (++). Given the use of different datasets, collected through a wide span of time and by different researchers, a data dictionary with the variables used in this study can also be found in the Supplementary materials and in our online repository.

An inherent caveat of using datasets collected by different researchers is related to the use of different methodologies, variables and measurements. This caveat is avoided in this study since the literature, approach and analysis method used in all data collection processes was similar. The lithic analysis adopted an attribute-based methodology, which aims to describe morphological and metrical attributes of technological classes. The attributes analysed followed those present in specialized literature, such as Brézillon (1968), and Tixier and Inizan (1980), paired with other Paleolithic lithic attribute analyses (see e.g., Bicho, 1992; Zilhão, 1997; Cascalheira, 2019; Almeida, 2000; Scerri et al., 2014; Tostevin, 2013).

After data collection, the databases were imported into R Programming Environment, where the information was processed through the creation of descriptive statistical analysis and writing of this article. Some differences in the collection process, especially between the study by Cascalheira (2010) and the following studies, required homogenization. For example, where in Cascalheira (2010) retouch was an independent variable, with a Yes or No option followed by a variable to classify the type of retouch, in Belmiro (2020) and Belmiro et al. (2021), retouch was identified in the Class variable as RetouchedPiece, followed by a variable to choose the retouch typology. In this situation, the Solutrean dataset was corrected, so that all artifacts with retouch were classified as RetouchedPiece in the Class variable, instead of the original classification. The original datasets without alterations can be found in the online repository, as all the alterations to the original datasets were done through R Studio and can be found in the original R Script. Finally, technological and raw material data had to be merged in a single dataset. This was done through the merging of the several datasets through the artifact identifier “ID”, the sequential identifier which is attributed to each total station plot during excavation, whether relating to individual artifacts plotted in their exact location, or bucket coordinates, relating to the center of the excavated area, and attributed to all artifacts found in the sieved sediment in the bucket. Since the raw material study only focused piece plotted artifacts with individual coordinates (leaving out bucket artifacts), as these correspond to artifacts with dimensions superior to 2 cm or complete bladelets (thus excluding small fragments and chips), the final dataset used in this study does not directly correspond to the full datasets analysed in the original studies. Similarly, the raw material study used only currently accessible artifacts from the assemblages. This is especially relevant for the Shelter Solutrean chert assemblage, where shatter is absent from the sample due to the availability for study. This stands as a caveat for the current study, since it is using only portion of the assemblages, leaving out possibly important debris. Despite this, the current study still offers a novel and key approach to the study of lithic assemblages at the site, with a methodology that includes all the knapping sequence, of a large number of artifacts from the UP sequence of a single site, as seen in table \*\*, which shows the number of artifacts used in the final analysis of this paper, after corrections, homogenization and merging.

```{r}
#| label: tbl-samples
#| tbl-cap: "Sample absolute number comparison between original datasets (chert and chalcedony only) for the Solutrean occupation of the Shelter area (levels A-C) published in Cascalheira (2010), the Proto-Solutrean occupation of the Terrace (levels 4E and 5) published in Belmiro et. al., (2021) and the Solutrean occupation of the Terrace (levels 6-7) and the final datasets used in the study after filtering individually plotted IDs (excluding bucket points) and merging with the geoarchaeological dataset published in Belmiro et al., (2025)."

table_samples <- tibble::tribble(
  ~Assemblage, ~`Original dataset (n)`, ~`Merged dataset (n)`,
  "Shelter level A-C", 3359, 910,
  "Terrace level 4E-5", 1821, 635,
  "Terrace level 6-7", 781, 766)

knitr::kable(head(table_samples))

```

After the homogenization and merging of the datasets, descriptive statistical analysis was applied to describe and interpret the relation between the raw material and technological data. As mentioned above, the goal of the study was to test two hypotheses related to the technological organisation of local and non-local cherts, and between different UP occupations. To test these hypotheses, we evaluated several parameters for each dataset and assemblage and compared the results between chert types and assemblages. The parameters evaluated in the current study were: P1) frequency of retouched tools; P2) frequency of maintenance products; P3) debitage sizes; P4) tools-to-debitage ratios; P5) core sizes; P6) blank-to-core ratios; P7) retouched tool sizes; P8) tool diversity; P9) tool specialization. Debitage, core and retouched tool sizes were analysed through descriptive statistics (mean, sd, min and max, tables available in the SOM\*\*) and plotted through boxplots. The ratios were obtained through the division of each group (e.g., tools by debitage and blanks by core), by chert type and assemblage. All other parameters were observed through number and percentages tables. All the analyses were done through code in R Studio.

The entirety of the R code used for the analysis, datasets, and visual representations contained in this paper can be accessed through our online research compendium. We used the rrtools package by Marwick et al. [-@marwickPackagingDataAnalytical2018] to create a research compendium and write a reproducible journal article. The provided files include the complete set of raw data used in the analysis, along with a custom R project [@wickhamPackagesOrganizeTest2015] containing the code required to generate all tables and figures. To enable maximum reuse, the code is made available under the MIT license, data under CC‐0, and figures under CC‐BY [additional details can be found in @marwickComputationalReproducibilityArchaeological2017].

# Results

```{r}
#| label: get-data

# Reading the datasets
## Technological data
gravettian_tech <- read_csv(here::here('analysis/data/raw_data/VBT_6_7_JB.csv'))
proto_tech <- read_csv(here::here('analysis/data/raw_data/VBT_4E_5_JB.csv'))
solutrean_JC <- read_csv(here::here('analysis/data/raw_data/VBR_ABC_JC.csv'))
solutrean_points <- read_csv(here::here('analysis/data/raw_data/shelter_points_JC.csv'))

## RM data
shelter_RM <- read_csv(here::here('analysis/data/raw_data/MACRO_IND_SHELTER.csv')) # Shelter RM analysis
terrace_RM <- read_csv(here::here('analysis/data/raw_data/MACRO_IND_TERRACE.csv')) # Terrace RM analysis

## Context data
context <- read_csv(here::here('analysis/data/raw_data/VB_Terrace_context.csv')) # Terrace Field DB - lithic artefact info
xyz <- read_csv(here::here('analysis/data/raw_data/VB_Terrace_xyz.csv')) # Terrace Field DB - just coordinates

```

```{r}
#| label: terrace-databases-setup

# Setting up the Terrace dataset
cols_to_concat_terrace <- c("UNIT", "ID") # Vector to join UNIT and ID into a single variable
context$ID <- str_squish(context$ID) # Remove empty spaces from ID field
xyz$ID <- str_squish(xyz$ID) # Remove empty spaces from UNIT field

# Cleaning up DS and uniformising variable names
proto_tech_WIP <- proto_tech |>
  tidyr::unite(col='ID', all_of(cols_to_concat_terrace), sep="-", remove=TRUE) |> 
  rename(CLASS = Class, COREPREPPROD = CorePreparProd, PIECECOMPLETENESS = PieceCompleteness, CORTEX = Cortex, CORTEXLOCATION = CortexLocation, PLATFORMTYPE = PlatformType, PLATFORMCORTEX = PlatformCortex, SCARCOUNT = ScarCount, THICKNESS = Thickness,
        MAXWIDTH = MaxWidth, LENGTH = Length, COREPLATFORM = CorePlatform, MAINFACECORTEX = MainFaceCortex, 
        MAINFACESCARCOUNT = MainFaceScarCount, COREABANDON = CoreAbandon, RETOUCHEDPIECETYPOLOGY = RetouchedPieceTypology) |> 
  mutate(RETOUCHEDPIECETYPOLOGY = case_when(
    RETOUCHEDPIECETYPOLOGY == "Right truncation on retouched piece" ~ "Truncation",
    RETOUCHEDPIECETYPOLOGY == "Double backed bladelet" | RETOUCHEDPIECETYPOLOGY == "Backed bladelet parcial" ~ "Backed bladelet",
    RETOUCHEDPIECETYPOLOGY == "Dentilhado" ~ "Denticulate",
    RETOUCHEDPIECETYPOLOGY == "Burin on truncation" ~ "Burin",
    TRUE ~ RETOUCHEDPIECETYPOLOGY)) |> 
  dplyr::select(ID, CLASS, COREPREPPROD, PIECECOMPLETENESS, CORTEX, CORTEXLOCATION, PLATFORMTYPE, PLATFORMCORTEX,
                SCARCOUNT, THICKNESS, MAXWIDTH, LENGTH, COREPLATFORM, MAINFACECORTEX, MAINFACESCARCOUNT, COREABANDON, RETOUCHEDPIECETYPOLOGY)

gravettian_tech <- gravettian_tech |> 
  mutate(RETOUCHEDPIECETYPOLOGY = case_when(
    RETOUCHEDPIECETYPOLOGY == "Splintered piece with notch" | RETOUCHEDPIECETYPOLOGY == "Splintered piece with lateral retouch" ~ "Splintered piece",
    RETOUCHEDPIECETYPOLOGY == "Retouched flake siret fragment" | RETOUCHEDPIECETYPOLOGY == "Retouched flake frag" ~ "Retouched flake fragment",
    RETOUCHEDPIECETYPOLOGY == "Retouched bladelet frag" ~ "Retouched bladelet fragment",
    RETOUCHEDPIECETYPOLOGY == "Multiple burin" | RETOUCHEDPIECETYPOLOGY == "Burin splintered piece" | RETOUCHEDPIECETYPOLOGY == "Burin on truncation" ~ "Burin",
    RETOUCHEDPIECETYPOLOGY == "Double backed bladelet" ~ "Backed bladelet",
    TRUE ~ RETOUCHEDPIECETYPOLOGY)) |> 
  mutate(CLASS = case_when(
    CLASS == "Flake" | CLASS == "ElongBlank" ~ "Blank",
    CLASS == "FlakeFrag" | CLASS == "ElongBlankFrag" ~ "BlankFrag",
    TRUE ~ CLASS))

terrace_tech <- bind_rows(proto_tech_WIP, gravettian_tech) # Creating single DS with Proto and Gravettian

terrace_RM_WIP <- terrace_RM |>
  mutate(RMTYPE = case_when(
    RMTYPE == "Type 2" ~ "TYPE 2",
    RMTYPE == "Chalcedony" ~ "TYPE 1", # Altering first group names to final group names. Subtypes are maintained as before.
    RMTYPE == "TYPE 15" ~ "TYPE 3",
    RMTYPE == "TYPE 7" ~ "TYPE 4",
    RMTYPE == "TYPE 12" ~ "TYPE 5",
    RMTYPE == "TYPE 11" ~ "TYPE 6",
    RMTYPE == "TYPE 13" ~ "TYPE 7",
    RMTYPE == "TYPE 11F" ~ "TYPE 8",
    RMTYPE == "TYPE 13B" ~ "TYPE 9",
    RMTYPE == "Oolitic" ~ "TYPE 10",
    RMTYPE == "TYPE GB" ~ "TYPE 11",
    .default = RMTYPE)) |> 
  select(AREA, ID, RMTYPE, SUBTYPE, WEIGHT, CORTEXTHICKNESS, CORTEXAPPEARANCE) |>
  distinct(ID, .keep_all = TRUE)

context <- context |>
  dplyr::rename("UNIT" = "Unit") |> # Renaming first column from Unit to UNIT to use cols_to_concat
  unite(col='ID', cols_to_concat_terrace, sep="-", remove=FALSE) |> # Unite UNIT with ID using cols_to_concat
  select(ID, Level, Spit, Code) |> # Selecting important variables: ID refers to artifact ID; Level refers to archaeologycal layer; Spit refers to artificial levels within an archaeological layer; Code refers to type of artifact (e.g., LITHIC or BONE)
  distinct(ID, .keep_all = TRUE)

xyz <- xyz |>
  unite(col='ID', cols_to_concat_terrace, sep="-", remove=FALSE) |> # Unite UNIT with ID using cols_to_concat
  filter(Suffix == 0) |> # To avoid several entries related to several points of the same artefact
  select(ID, X, Y, Z) |> # Selecting important variables
  distinct(ID, .keep_all = TRUE)

field_data <- full_join(xyz, context, by = "ID") # Join field tables

terrace_tech_WIP <- left_join(terrace_tech, field_data, by = "ID") # Join field and RM type tables
terrace_dataset <- full_join(terrace_tech_WIP, terrace_RM_WIP, by = "ID") # Base 12690
terrace_dataset <- terrace_dataset |>
  filter(!Level %in% c("3", "4", "4C", "4D")) |>  # Dropping NAs on the technological class drops dataset to 1651
  drop_na(RMTYPE) |>  # Dropping NAs on the RM database drops dataset to 3635
  drop_na(CLASS) # Dropping NAs on the technological class drops dataset to 1647
  
# Mutate level 5 to add phases: top of 5 (4E/5) and bottom of 5 (5), following Belmiro et al. (2020).
phase_dataset <- terrace_dataset |> 
  mutate(Level = case_when(
    Level == 5 & Z > 24.1 ~ "4E/5",
    Level == 5 & Z < 24.1 ~ "5",
    Level == "7C" | Level == 8 ~ "7", # Collapsing samples from Level 7C and Level 8 into 7 to homogenise dataset
    TRUE ~ Level)) |> # Adding technocomplex name based on the levels
  mutate(Technocomplex = case_when(
    Level == "4E" | Level == "4E/5" | Level == 5 ~ "Proto-Solutrean",
    Level == 6 | Level == 7 ~ "Gravettian"))

```

```{r}
#| label: shelter-solutrean-setup

# Setting up the Terrace dataset
cols_to_concat_shelter <- c("YEAR", "ID") # Concatenate YEAR and ID variables in one single variable (e.g. 05-500)

solutrean_WIP <- solutrean_JC |> 
  filter(Layer %in% c("A", "B", "C")) |> # Filtering Solutrean layers
  filter(`Raw material` %in% c("Chert", "Chalcedony")) |>  # Filtering raw materials
  filter(!Screen %in% c("Crivo", "crivo")) |>  # Filtering out all bucket lithics since they were not included in the RM analysis
  mutate_at("Date", str_replace, "20", "") |> # Removing initial part of the year to match IDs
  dplyr::rename("YEAR" = "Date") |> 
  tidyr::unite(col='ID', all_of(cols_to_concat_shelter), sep="-", remove=FALSE) # Concatenate YEAR and ID variables in one single variable (e.g. 05-500)

# Dataset filtering for chert/chalcedony and levels (A-C), 3298 + 61 solutrean points, n=3359
solutrean_original_chert <- solutrean_JC |> 
  filter(Layer %in% c("A", "B", "C")) |> # Filtering Solutrean layers
  filter(`Raw material` %in% c("Chert", "Chalcedony"))

# In Cascalheira 2010 Retouched piece was not a category but a variable. To match the other DBs, this category was added
solutrean_WIP <- solutrean_WIP |> 
  mutate(Class = case_when( # This alteration is being done on the original class column
    Retouched == "Yes" ~ "RetouchedPiece", # Whenever retouch is present, class is now Retouched piece
    TRUE ~ Class)) |> 
  mutate(CLASS = case_when( # Creating a column for clustered classes, to match the other DBs
    Class == "Blade" | Class == "Bladelet" ~ "ElongBlank", # Cluster blades with bladelets. The distinction can come later through a mutate and the measurements
    Class == "Core front" | Class == "Core tablet" | Class == "Core trimming elem." | Class == "Crested piece" ~ "CorePrepProd", # Cluster all preparation products
    Class == "Fragment" ~ "Shatter",
    Class == "Flake distal frag." | Class == "Flake mesial frag." | Class == "Flake prox. frag." ~ "FlakeFrag", # Cluster flake frags into a single category
    Class == "Blade distal frag." | Class == "Blade mesial frag." | Class == "Blade prox. frag." 
    | Class == "Bladelet distal frag." | Class == "Bladelet mesial frag." | Class == "Bladelet prox. frag." ~ "ElongBlankFrag", # Cluster elong frags into a single category
    TRUE ~ Class)) |> 
  mutate(COREPREPPROD = case_when( # Creating a column for the types of core preparation and maintenance products (COREPREPPROD)
    Class == "Core front" ~ "Core front",
    Class == "Core tablet" ~ "Core tablet",
    Class == "Core trimming elem." ~ "Core trim",
    Class == "Crested piece" ~ "Crested piece")) |> 
  mutate(PIECECOMPLETENESS = case_when( # Creating a column for the portions present in flake or elongblank fragments to match other DBs
    Class == "Flake distal frag." | Class == "Blade distal frag." | Class == "Bladelet distal frag." ~ "Distal",
    Class == "Flake mesial frag." | Class == "Blade mesial frag." | Class == "Bladelet mesial frag." ~ "Mesial",
    Class == "Flake prox. frag." | Class == "Blade prox. frag." | Class == "Bladelet prox. frag." ~ "Proximal")) |> 
  rename(PLATFORMTYPE = Platform_type) |> # Renaming column
  mutate(PLATFORMTYPE = case_when( # Renaming variables to match correspondent variables in the other DBs
    PLATFORMTYPE == "Multifacetted" ~ "Faceted",
    PLATFORMTYPE == "Unfacetted" ~ "Plain",
    TRUE ~ PLATFORMTYPE)) |>
  mutate(Type = case_when( # Translating retouched types from Zilhão 1997 to simplified typologies
    Type == "92b" ~ "Retouched piece fragment",
    Type == "92a" ~ "Retouched blank",
    Type == "76" ~ "Splintered piece",
    Type == "75" ~ "Denticulate",
    Type == "74" ~ "Notch",
    Type == "66" ~ "Retouched blade",
    Type == "61" ~ "Truncation",
    Type == "28" ~ "Burin",
    Type == "7" | Type == "5b" | Type == "4"  ~ "Endscrapper",
    TRUE ~ Type)) |>
  rename(LEVEL = Layer, UNIT = Unit, CORTEX = Percent_of_cortex, CORTEXLOCATION = Loc_of_cortex, THICKNESS = Thickness,
         MAXWIDTH = Width, LENGTH = Length, COREPLATFORM = Core_platfform, SCARCOUNT = N_of_Scars, COREABANDON = Core_abandon,
         RETOUCHEDPIECETYPOLOGY = Type)  # Renaming column
  
solutrean_tech <- solutrean_WIP |>
  dplyr::select(ID, CLASS, LEVEL, UNIT, COREPREPPROD, PIECECOMPLETENESS, CORTEX, CORTEXLOCATION, PLATFORMTYPE,
                SCARCOUNT, THICKNESS, MAXWIDTH, LENGTH, COREPLATFORM, COREABANDON, RETOUCHEDPIECETYPOLOGY)

solutrean_points <- solutrean_points |> 
  mutate_at("YEAR", str_replace, "20", "") |> # Removing initial part of the year to match IDs
  tidyr::unite(col='ID', all_of(cols_to_concat_shelter), sep="-", remove=TRUE)
  
solutrean_tech <- bind_rows(solutrean_tech, solutrean_points) # Uniting technology dataset with points (2167 to 2228)

solutrean_tech <- solutrean_tech |> # Originally 2228
  distinct(ID, .keep_all = TRUE) # Keeping individual IDs to avoid buckets (down to 1993)

shelter_RM_WIP <- shelter_RM |>
  mutate_at("ID", str_replace, "VB", "") |> # Remove "VB" from ID
  mutate(RMTYPE = case_when(
    RMTYPE == "Type 2" ~ "TYPE 2",
    RMTYPE == "Chalcedony" ~ "TYPE 1", # Altering first group names to final group names. Subtypes are maintained as before.
    RMTYPE == "TYPE 15" ~ "TYPE 3",
    RMTYPE == "TYPE 7" ~ "TYPE 4",
    RMTYPE == "TYPE 12" ~ "TYPE 5",
    RMTYPE == "TYPE 11" ~ "TYPE 6",
    RMTYPE == "TYPE 13" ~ "TYPE 7",
    RMTYPE == "TYPE 11F" ~ "TYPE 8",
    RMTYPE == "TYPE 13B" ~ "TYPE 9",
    RMTYPE == "Oolitic" ~ "TYPE 10",
    RMTYPE == "TYPE GB" ~ "TYPE 11",
    RMTYPE == "ND_A" ~ "INDET",
    .default = RMTYPE)) |>
  select(AREA, ID, RMTYPE, SUBTYPE, WEIGHT, CORTEXTHICKNESS, CORTEXAPPEARANCE) |>  # Select variables
  distinct(ID, .keep_all = TRUE) # Keeping individual IDs to avoid buckets

solutrean_dataset <- full_join(solutrean_tech, shelter_RM_WIP, by = "ID") # The complete dataset has 2818 (44 points) entries
solutrean_dataset <- solutrean_dataset |>
  drop_na(RMTYPE) |>   # Dropping NAs on the RM database drops dataset to 1514
  drop_na(CLASS) # Dropping NAs on the technological class drops dataset to 914
  
```

```{r}
#| label: general-tables

# Tables with class by raw material type (n and %)
##
general_table <- phase_dataset |> 
    dplyr::mutate(RMTYPE = case_when(
    RMTYPE == "TYPE 1" | RMTYPE == "TYPE 2" | RMTYPE == "TYPE 3" | RMTYPE == "TYPE 4" | RMTYPE == "TYPE 5" ~ "Local",
    RMTYPE == "TYPE 6" ~ "T6",
    RMTYPE == "TYPE 7" ~ "T7",
    RMTYPE == "TYPE 8" ~ "T8",
    RMTYPE == "TYPE 9" ~ "T9",
    RMTYPE == "TYPE 10" ~ "T10",
    TRUE ~ RMTYPE)) |> 
  dplyr::mutate(CLASS = case_when(
    CLASS == "BlankFrag" ~ "Blank fragment",
    CLASS == "BurinSpall" ~ "Burin spall",
    CLASS == "CoreFrag" ~ "Core fragment",
    CLASS == "CorePreparProd" ~ "Core prep product",
    CLASS == "RetouchedPiece" ~ "Retouched",
    CLASS == "RetouchedPieceFrag" ~ "Retouched fragment",
    TRUE ~ CLASS)) |> 
  dplyr::mutate(RETOUCHEDPIECETYPOLOGY = case_when(
    RETOUCHEDPIECETYPOLOGY == "Retouched blade" | RETOUCHEDPIECETYPOLOGY == "Retouched bladelet" | RETOUCHEDPIECETYPOLOGY == "Retouched bladelet fragment" | RETOUCHEDPIECETYPOLOGY == "Retouched flake" | RETOUCHEDPIECETYPOLOGY == "Retouched flake fragment" ~ "Retouched blank",
    RETOUCHEDPIECETYPOLOGY == "Splintered piece fragment" ~ "Splintered piece",
    TRUE ~ RETOUCHEDPIECETYPOLOGY))

general_table_solutrean <- solutrean_dataset |> 
   dplyr::mutate(RMTYPE = case_when(
    RMTYPE == "TYPE 1" | RMTYPE == "TYPE 2" | RMTYPE == "TYPE 3" | RMTYPE == "TYPE 4" | RMTYPE == "TYPE 5" ~ "Local",
    RMTYPE == "TYPE 6" ~ "T6",
    RMTYPE == "TYPE 7" ~ "T7",
    RMTYPE == "TYPE 8" ~ "T8",
    RMTYPE == "TYPE 9" ~ "T9",
    RMTYPE == "TYPE 10" ~ "T10",
    RMTYPE == "TYPE 11" ~ "T11",
    TRUE ~ RMTYPE)) |> 
  dplyr::mutate(CLASS = case_when(
    CLASS == "ElongBlank" | CLASS == "Flake" ~ "Blank",
    CLASS == "ElongBlankFrag" | CLASS == "FlakeFrag" ~ "Blank fragment",
    CLASS == "Thinning flake" ~ "Blank",
    CLASS == "CorePrepProd" ~ "Core prep product",
    CLASS == "RetouchedPiece" | CLASS == "Retouched piece" ~ "Retouched",
    CLASS == "Retouched piece fragment" ~ "Retouched fragment",
    TRUE ~ CLASS))

## For Gravettian
gravettian_general <- general_table |>
  filter(Level %in% c(6, 7)) |>
  filter(RMTYPE != "INDET") |> 
  mutate(RMTYPE = factor(RMTYPE, levels = c("Local", "T6","T7", 
                                        "T8", "T9", "T10", "TL"))) |>
  tabyl(CLASS, RMTYPE) |> 
  adorn_totals(c("row", "col")) |> 
  adorn_percentages("col") |> 
  adorn_pct_formatting(2) |> 
  adorn_ns("front") |> 
  mutate(across(where(is.character), ~ gsub("^0   \\(0\\.00%\\)$", " ", .)))

## For Proto-Solutrean (4E and top of 5)
proto_general <- general_table |> 
  filter(Level %in% c("4E", "4E/5")) |> 
  filter(CLASS != "Chip") |> 
  filter(RMTYPE != "INDET") |> 
  mutate(RMTYPE = factor(RMTYPE, levels = c("Local", "T6","T7", 
                                        "T8", "T9", "T10", "TL"))) |> 
  tabyl(CLASS, RMTYPE) |> 
  adorn_totals(c("row", "col")) |> 
  adorn_percentages("col") |> 
  adorn_pct_formatting(2) |> 
  adorn_ns("front") |> 
  mutate(across(where(is.character), ~ gsub("^0   \\(0\\.00%\\)$", " ", .)))

## For Solutrean
solutrean_general <- general_table_solutrean |> 
  filter(RMTYPE != "INDET") |> 
  mutate(RMTYPE = factor(RMTYPE, levels = c("Local", "T6","T7", 
                                        "T8", "T9", "T10", "T11", "TL"))) |> 
  tabyl(CLASS, RMTYPE) |> 
  adorn_totals(c("row", "col")) |> 
  adorn_percentages("col") |> 
  adorn_pct_formatting(2) |> 
  adorn_ns("front") |> 
  mutate(across(where(is.character), ~ gsub("^0   \\(0\\.00%\\)$", " ", .)))

```

```{r}
#| label: stats-setup

# Scatterplots for width and length and Boxplots for weight by assemblage

# Solutrean statistics
# DS preparation
solutrean_stats <- solutrean_dataset |> 
  filter(RMTYPE != "INDET") |>
   mutate(CLASS = case_when(
    CLASS == "ElongBlank" ~ "Blank",
    CLASS == "Flake" ~ "Blank",
    CLASS == "FlakeFrag" | CLASS == "ElongBlankFrag" ~ "BlankFrag",
    TRUE ~ CLASS)) |> 
  dplyr::mutate(RMTYPE = case_when(
    RMTYPE == "TYPE 1" | RMTYPE == "TYPE 2" | RMTYPE == "TYPE 3" | RMTYPE == "TYPE 4" | RMTYPE == "TYPE 5" ~ "Local",
    RMTYPE == "TYPE 6" ~ "T6",
    RMTYPE == "TYPE 7" ~ "T7",
    RMTYPE == "TYPE 8" ~ "T8",
    RMTYPE == "TYPE 9" ~ "T9",
    RMTYPE == "TYPE 10" ~ "T10",
    RMTYPE == "TYPE 11" ~ "T11",
    TRUE ~ RMTYPE))

# Scatterplot for width and length
solutrean_scatter <- solutrean_stats |>
  filter(CLASS %in% c("Blank", "Core")) |>
  filter(MAXWIDTH !="0" & LENGTH != "0") |>
  mutate(RMTYPE = factor(RMTYPE, levels = c("Local", "T6","T7", 
                                        "T8", "T9", "T10", "T11", "TL"))) |>
  mutate(CLASS = factor(CLASS, levels = c("Blank", "Core"))) |>
  ggplot(aes(x = LENGTH, y = MAXWIDTH, fill = RMTYPE)) +
  geom_point(alpha = 0.9, size = 3, shape = 21, colour = "black") +
  facet_wrap(~CLASS) +
  labs(x="Length (mm)", y="Max. Width (mm)") +
  scale_fill_manual(values = c("#D49B54", "#8B6969", "#CDAF95", "#2B4F60",
                              "tomato4", "#BDC7C9", "#798777"))

# Boxplot for individual measurements
# Weight
solutrean_stats_weight <- solutrean_stats |>
  filter(CLASS %in% c("Blank", "Core")) |> 
  filter(WEIGHT !="0") |>
  mutate(RMTYPE = factor(RMTYPE, levels = c("Local", "T6","T7", 
                                        "T8", "T9", "T10", "T11", "TL"))) |>
  mutate(CLASS = factor(CLASS, levels = c("Blank", "Core"))) |>
  ggplot(aes(RMTYPE, WEIGHT, fill = RMTYPE)) +
  geom_boxplot(aes(fill=factor(RMTYPE)), outlier.shape=21) +
  facet_wrap(~CLASS, scales = "free_y") +
  stat_summary(fun=mean, geom="point", shape=23) +
  labs(x="Raw material types" ,y="Weight (gr)") +
  #coord_cartesian(ylim =  c(0, 50)) +
  scale_fill_manual(values = c("#D49B54", "#8B6969", "#CDAF95", "#2B4F60",
                              "tomato4", "#BDC7C9", "#798777")) +
  theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank())

# Proto-Solutrean statistics
# DS prep
proto_stats <- phase_dataset |> 
  filter(Level %in% c("4E", "4E/5")) |> 
  filter(!RMTYPE == "INDET") |>
  dplyr::mutate(RMTYPE = case_when(
    RMTYPE == "TYPE 1" | RMTYPE == "TYPE 2" | RMTYPE == "TYPE 3" | RMTYPE == "TYPE 4" | RMTYPE == "TYPE 5" ~ "Local",
    RMTYPE == "TYPE 6" ~ "T6",
    RMTYPE == "TYPE 7" ~ "T7",
    RMTYPE == "TYPE 8" ~ "T8",
    RMTYPE == "TYPE 9" ~ "T9",
    RMTYPE == "TYPE 10" ~ "T10",
    TRUE ~ RMTYPE))

# Scatterplots for width and length
proto_scatter <- proto_stats |>
  filter(CLASS %in% c("Blank", "Core")) |>
  filter(MAXWIDTH !="0" & LENGTH != "0") |>
   mutate(RMTYPE = factor(RMTYPE, levels = c("Local", "T6","T7", 
                                        "T8", "T9", "T10", "TL"))) |>
  mutate(CLASS = factor(CLASS, levels = c("Blank", "Core"))) |>
  ggplot(aes(x = LENGTH, y = MAXWIDTH, fill = RMTYPE)) +
  geom_point(alpha = 0.9, size = 3, shape = 21, colour = "black") +
  facet_wrap(~CLASS) +
  labs(x="Length (mm)", y="Max. Width (mm)") +
  scale_fill_manual(values = c("#D49B54", "#8B6969", "#CDAF95", "#2B4F60",
                              "tomato4", "#BDD2B6", "#798777", "#BDC7C9"))

# Boxplots weight
proto_stats_weight <- proto_stats |>
  filter(CLASS %in% c("Blank", "Core")) |> 
  filter(WEIGHT !="0") |>
  mutate(RMTYPE = factor(RMTYPE, levels = c("Local", "T6", "T7", "T8", "T9", "T10", "TL"))) |>
  mutate(CLASS = factor(CLASS, levels = c("Blank", "Core"))) |>
  ggplot(aes(RMTYPE, WEIGHT, fill = RMTYPE)) +
  geom_boxplot(aes(fill=factor(RMTYPE)), outlier.shape=21) +
  facet_wrap(~CLASS, scales = "free_y") +
  stat_summary(fun.y=mean, geom="point", shape=23) +
  labs(x="Raw material types", y="Weight (gr)") +
  #coord_cartesian(ylim =  c(0, 50)) +
  scale_fill_manual(values = c("#D49B54", "#8B6969", "#CDAF95", "#2B4F60",
                              "tomato4", "#BDD2B6", "#798777", "#BDC7C9")) +
  theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank())


# Gravettian statistics
# DS prep
gravettian_stats <- phase_dataset |>
  filter(Level %in% c(6, 7)) |>
  filter(RMTYPE != "INDET") |>
  dplyr::mutate(RMTYPE = case_when(
    RMTYPE == "TYPE 1" | RMTYPE == "TYPE 2" | RMTYPE == "TYPE 3" | RMTYPE == "TYPE 4" | RMTYPE == "TYPE 5" ~ "Local",
    RMTYPE == "TYPE 6" ~ "T6",
    RMTYPE == "TYPE 7" ~ "T7",
    RMTYPE == "TYPE 8" ~ "T8",
    RMTYPE == "TYPE 9" ~ "T9",
    RMTYPE == "TYPE 10" ~ "T10",
    TRUE ~ RMTYPE))

# Scatterplots for width and length
gravettian_scatter <- gravettian_stats |>
  filter(CLASS %in% c("Blank", "Core")) |>
  filter(MAXWIDTH !="0" & LENGTH != "0") |>
   mutate(RMTYPE = factor(RMTYPE, levels = c("Local", "T6","T7", 
                                        "T8", "T9", "T10", "TL"))) |>
  mutate(CLASS = factor(CLASS, levels = c("Blank", "Core"))) |>
  ggplot(aes(x = LENGTH, y = MAXWIDTH, fill = RMTYPE)) +
  geom_point(alpha = 0.9, size = 3, shape = 21, colour = "black") +
  facet_wrap(~CLASS) +
  labs(x="Length (mm)", y="Max. Width (mm)") +
  scale_fill_manual(values = c("#D49B54", "#8B6969", "#CDAF95", "#2B4F60",
                              "#8B7D6B", "#BDD2B6", "#798777", "#BDC7C9"))

# Boxplots
# Weight
gravettian_stats_weight <- gravettian_stats |>
  filter(CLASS %in% c("Blank", "Core")) |> 
  filter(WEIGHT !="0") |>
  filter(!(RMTYPE == "Local" & WEIGHT > 40)) |> # Removed a single outlier at 60 weight while ensuring that the data remains consistent. Only mean changed significantly and was normalised
  mutate(RMTYPE = factor(RMTYPE, levels = c("Local", "T6", "T7", "T8", "T9", "T10", "TL"))) |>
  mutate(CLASS = factor(CLASS, levels = c("Blank", "Core"))) |>
  ggplot(aes(RMTYPE, WEIGHT, fill = RMTYPE)) +
  geom_boxplot(aes(fill=factor(RMTYPE)), outlier.shape=21) +
  facet_wrap(~CLASS, scales = "free_y") +
  stat_summary(fun.y=mean, geom="point", shape=23) +
  labs(x= "Raw material types", y="Weight (gr)") +
  #coord_cartesian(ylim =  c(0, 60)) +
  scale_fill_manual(values = c("#D49B54", "#8B6969", "#CDAF95", "#2B4F60",
                              "#8B7D6B", "#BDD2B6", "#798777", "#BDC7C9")) +
  theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank())

```

```{r}
#| label: tool-diversity

# Solutrean table
## Table preparation
solutrean_retouch <- general_table_solutrean |>
  filter(CLASS %in% c("Retouched", "Retouched fragment")) |>
  filter(RMTYPE != "INDET") |> 
  filter(RETOUCHEDPIECETYPOLOGY != "") |> 
  tabyl(RETOUCHEDPIECETYPOLOGY, RMTYPE) |>
  adorn_totals(c("row", "col")) |>
  mutate(across(where(is.numeric), ~ ifelse(. == 0, " ", .))) |>
  select(RETOUCHEDPIECETYPOLOGY, Local, T6, T7, T8, T11, Total) |> # Ordering values
  rename(Typology = RETOUCHEDPIECETYPOLOGY)

# Proto-solutrean table
## Table preparation
proto_retouch <- general_table |>
  filter(CLASS %in% c("Retouched", "Retouched fragment")) |>
  filter(Level %in% c("4E", "4E/5")) |>
  filter(!RMTYPE == "INDET") |> 
  tabyl(RETOUCHEDPIECETYPOLOGY, RMTYPE) |>
  adorn_totals(c("row", "col")) |> 
  mutate(across(where(is.numeric), ~ ifelse(. == 0, " ", .))) |>
  select(RETOUCHEDPIECETYPOLOGY, Local, T6, T7, T8, T9, TL, Total) |> # Ordering values
  rename(Typology = RETOUCHEDPIECETYPOLOGY)

# Gravettian table
## Table preparation
gravettian_retouch <- general_table |> 
  filter(CLASS %in% c("Retouched", "Retouched fragment")) |>
  filter(Level %in% c(6, 7)) |> 
  filter(!RMTYPE == "INDET") |> 
  tabyl(RETOUCHEDPIECETYPOLOGY, RMTYPE) |>
  adorn_totals(c("row", "col")) |>
  mutate(across(where(is.numeric), ~ ifelse(. == 0, " ", .))) |>
  select(RETOUCHEDPIECETYPOLOGY, Local, T6, T7, T8, T9, T10, TL, Total) |> # Ordering values
  rename(Typology = RETOUCHEDPIECETYPOLOGY)

```

```{r}
#| label: tbl-general
#| tbl-cap: Number and percentage of technotypological classes by raw material type of the Gravettian (a), Proto-Solutrean (b) and Solutrean (c) assemblages.
#| tbl-subcap: 
#| - "Number and percentage of technotypological classes by raw material from the Gravettian assemblage (levels 6 and 7) of the Terrace area."
#| - "Number and percentage of technotypological classes by raw material from the Proto-Solutrean assemblage (levels 4E and 5) of the Terrace area."
#| - "Number and percentage of technotypological classes by raw material from the Solutrean assemblage (levels A-C) of the Shelter area."
#| layout-nrow: 4

kable(gravettian_general)
kable(proto_general)
kable(solutrean_general)

```

```{r}
#| label: tbl-retouch
#| tbl-cap: Number and percentage of retouched tools by raw material of the Gravettian (a), Proto-Solutrean (b) and Solutrean (c) assemblages. Retouched blank typology includes flakes, blades and bladelets and respective fragments.
#| tbl-subcap: 
#| - "Number and percentage of retouched tools by raw material from the Gravettian assemblage (levels 6 and 7) of the Terrace area."
#| - "Number and percentage of retouched tools by raw material from the Proto-Solutrean assemblage (levels 4E and 5) of the Terrace area."
#| - "Number and percentage of retouched tools by raw material from the Solutrean assemblage (levels A-C) of the Shelter area."
#| layout-nrow: 4

kable(gravettian_retouch)
kable(proto_retouch)
kable(solutrean_retouch)
  
```

Retouched tools were further explored through the tools-to-debitage ratio (@fig-ratiotd and table s++). As seen in @fig-ratiotd, local cherts (T1-5) show low ratios (\~2.5-0.5) of retouched tools to blanks, while TL and T6-T8 show higher ratios (\~0.9-1.0). The exception is T10 (non-local type), which shows a lower ratio (\~0.3), more akin to local cherts. The relation between blank and core numbers was also explored through a blank-to-core ratio (@fig-ratiobc and table s++). The results show that local types T1 and T2 show lower ratios (\<4) of blanks to cores, although other local types (T3-T5) have no identified cores @tbl-general-gravettian. The non-local types, especially T6 and T7 show higher ratios (\~8) of blanks to cores, with T10 once again showing values similar to local cherts (\~4).

```{r}
#| label: fig-ratiobc
#| fig-cap: Plotted ratios of blanks-to-core by assemblage and by chert type. All local cherts were grouped in a single category "Local", while non-local cherts maintained their individual IDs.

# DS preparation and tool-to-debitage ratio tables
## For Gravettian
gravettian_ratiobc <- phase_dataset |> 
  filter(Level %in% c(6, 7)) |> 
  filter(RMTYPE != "INDET") |> 
  mutate(CLASS = case_when(
    CLASS == "BlankFrag" & PIECECOMPLETENESS == "Proximal" ~ "Blank", # To add proximal fragments to ratio
    TRUE ~ CLASS)) |> 
  filter(CLASS %in% c("Blank", "Core")) |> 
  count(RMTYPE, CLASS, sort = TRUE) |> 
  group_by(RMTYPE, CLASS) |>
  summarise(n=sum(n)) |> 
  spread(CLASS, n, fill=0) |> 
  mutate(sum = rowSums(across(where(is.numeric)))) |> 
  filter(!sum <= 5) |> 
  mutate("Blank/Core" = Blank / Core)

# For Proto-Solutrean
proto_ratiobc <- phase_dataset |> 
  filter(Level %in% c("4E", "4E/5")) |> 
  filter(RMTYPE != "INDET") |> 
  mutate(CLASS = case_when(
    CLASS == "BlankFrag" & PIECECOMPLETENESS == "Proximal" ~ "Blank", # To add proximal fragments to ratio
    TRUE ~ CLASS)) |> 
  filter(CLASS %in% c("Blank", "Core")) |> 
  count(RMTYPE, CLASS, sort = TRUE) |> 
  group_by(RMTYPE, CLASS) |>
  summarise(n=sum(n)) |> 
  spread(CLASS, n, fill=0) |> 
  mutate(sum = rowSums(across(where(is.numeric)))) |> 
  filter(!sum <= 5) |>
  mutate("Blank/Core" = Blank / Core)

# For Solutrean
solutrean_ratiobc <- solutrean_dataset |> 
  mutate(CLASS = case_when(
    CLASS == "Flake" | CLASS == "ElongBlank" | CLASS == "Thinning flake" ~ "Blank",
    CLASS == "FlakeFrag" | CLASS == "ElongBlankFrag" ~ "BlankFrag",
    TRUE ~ CLASS)) |> 
  mutate(CLASS = case_when(
    CLASS == "BlankFrag" & PIECECOMPLETENESS == "Proximal" ~ "Blank", # To add proximal fragments to ratio
    TRUE ~ CLASS)) |> 
  filter(RMTYPE != "INDET") |> 
  filter(CLASS %in% c("Blank", "Core")) |> 
  count(RMTYPE, CLASS, sort = TRUE) |> 
  group_by(RMTYPE, CLASS) |>
  summarise(n=sum(n)) |> 
  spread(CLASS, n, fill=0) |> 
  mutate(sum = rowSums(across(where(is.numeric)))) |> 
  filter(!sum <= 5) |> 
  mutate("Blank/Core" = Blank / Core)

# Cleaning up to create a single table for scatterplot
gravettian_ratiobc_b <-gravettian_ratiobc |>
  filter(`Blank/Core` != "Inf") |> 
  dplyr::mutate("Assemblage" = "Gravettian") |> 
  select(Assemblage, RMTYPE, `Blank/Core`)
proto_ratiobc_b <- proto_ratiobc |> 
  filter(`Blank/Core` != "Inf") |> 
  dplyr::mutate("Assemblage" = "Proto-Solutrean") |> 
  select(Assemblage, RMTYPE, `Blank/Core`)
solutrean_ratiobc_b <- solutrean_ratiobc |> 
  filter(`Blank/Core` != "Inf") |> 
  dplyr::mutate("Assemblage" = "Solutrean") |> 
  select(Assemblage, RMTYPE, `Blank/Core`)
ratio_blankcore <- bind_rows(gravettian_ratiobc_b, proto_ratiobc_b,solutrean_ratiobc_b)

# Scatterplot with local vs non-local RM Types
ratio_blankcore |>
  dplyr::mutate(Source = case_when(
    RMTYPE == "TYPE 1" | RMTYPE == "TYPE 2" | RMTYPE == "TYPE 3" | RMTYPE == "TYPE 4" | RMTYPE == "TYPE 5" ~ "Local",
    RMTYPE == "TYPE 6" ~ "T6",
    RMTYPE == "TYPE 7" ~ "T7",
    RMTYPE == "TYPE 8" ~ "T8",
    RMTYPE == "TYPE 9" ~ "T9",
    RMTYPE == "TYPE 10" ~ "T10",
    RMTYPE == "TYPE 11" ~ "T11",
    TRUE ~ RMTYPE)) |>
  mutate(Source = factor(Source, levels = c("Local", "T6","T7", 
                                        "T8", "T9", "T10", "T11", "TL"))) |>
  ggplot(aes(x=Assemblage, y=`Blank/Core`, colour = Source)) +
  geom_point(size=3) +
  coord_cartesian(clip = "off") +
  scale_colour_manual(values = c("#D49B54", "#8B6969", "#CDAF95", "#2B4F60",
                              "#BDD2B6"))

```

```{r}
#| label: fig-ratiotd
#| fig-cap: Plotted ratios of tools-to-debitage by assemblage and by chert type. All local cherts were grouped in a single category "Local", while non-local cherts maintained their individual IDs.

# DS preparation and tool-to-debitage ratio tables
## For Gravettian
gravettian_ratiotd <- phase_dataset |> 
  filter(Level %in% c(6, 7)) |> 
  filter(RMTYPE != "INDET") |> 
  mutate(CLASS = case_when(
    CLASS == "BlankFrag" & PIECECOMPLETENESS == "Proximal" ~ "Blank", # To add proximal fragments to ratio
    CLASS == "RetouchedPieceFrag" & PIECECOMPLETENESS == "Proximal" ~ "RetouchedPiece",
    TRUE ~ CLASS)) |> 
  filter(CLASS %in% c("Blank", "RetouchedPiece")) |> 
  count(RMTYPE, CLASS, sort = TRUE) |> 
  group_by(RMTYPE, CLASS) |>
  summarise(n=sum(n)) |> 
  spread(CLASS, n, fill=0) |> 
  mutate(sum = rowSums(across(where(is.numeric)))) |> 
  filter(!sum <= 5) |> 
  mutate("Tool/Blank" = RetouchedPiece / Blank)

## For Proto-Solutrean
proto_ratiotd <- phase_dataset |> 
  filter(Level %in% c("4E", "4E/5")) |> 
  filter(RMTYPE != "INDET") |> 
  mutate(CLASS = case_when(
    CLASS == "BlankFrag" & PIECECOMPLETENESS == "Proximal" ~ "Blank", # To add proximal fragments to ratio
    CLASS == "RetouchedPieceFrag" & PIECECOMPLETENESS == "Proximal" ~ "RetouchedPiece",
    TRUE ~ CLASS)) |> 
  filter(CLASS %in% c("Blank", "RetouchedPiece")) |> 
  count(RMTYPE, CLASS, sort = TRUE) |> 
  group_by(RMTYPE, CLASS) |>
  summarise(n=sum(n)) |> 
  spread(CLASS, n, fill=0) |> 
  mutate(sum = rowSums(across(where(is.numeric)))) |> 
  filter(!sum <= 5) |> 
  mutate("Tool/Blank" = RetouchedPiece / Blank)

## For Solutrean
solutrean_ratiotd <- solutrean_dataset |> 
  filter(RMTYPE != "INDET") |> 
  mutate(CLASS = case_when(
    CLASS == "Flake" | CLASS == "ElongBlank" | CLASS == "Thinning flake" ~ "Blank",
    CLASS == "FlakeFrag" | CLASS == "ElongBlankFrag" ~ "BlankFrag",
    CLASS == "Retouched piece" ~ "RetouchedPiece",
    CLASS == "Retouched piece fragment" ~ "RetouchedPieceFrag",
    TRUE ~ CLASS)) |> 
  mutate(CLASS = case_when(
    CLASS == "BlankFrag" & PIECECOMPLETENESS == "Proximal" ~ "Blank", # To add proximal fragments to ratio
    CLASS == "RetouchedPieceFrag" & PIECECOMPLETENESS == "Proximal" ~ "RetouchedPiece",
    TRUE ~ CLASS)) |> 
  filter(CLASS %in% c("Blank", "RetouchedPiece")) |> 
  count(RMTYPE, CLASS, sort = TRUE) |> 
  group_by(RMTYPE, CLASS) |>
  summarise(n=sum(n)) |> 
  spread(CLASS, n, fill=0) |> 
  mutate(sum = rowSums(across(where(is.numeric)))) |> 
  filter(!sum <= 5) |> 
  mutate("Tool/Blank" = RetouchedPiece / Blank)

# Creating a single table with all ratios by assemblage for the scatterplot
gravettian_ratiotd_b <-gravettian_ratiotd |> 
  dplyr::mutate("Assemblage" = "Gravettian") |> 
  select(Assemblage, RMTYPE, `Tool/Blank`)
proto_ratiotd_b <- proto_ratiotd |> 
  dplyr::mutate("Assemblage" = "Proto-Solutrean") |> 
  select(Assemblage, RMTYPE, `Tool/Blank`)
solutrean_ratiotd_b <- solutrean_ratiotd |> 
  dplyr::mutate("Assemblage" = "Solutrean") |> 
  select(Assemblage, RMTYPE, `Tool/Blank`)
ratio_tooldebitage <- bind_rows(gravettian_ratiotd_b, proto_ratiotd_b,solutrean_ratiotd_b)

# Scatterplot with local vs non-local RM Types
ratio_tooldebitage |>
  dplyr::mutate(Source = case_when(
    RMTYPE == "TYPE 1" | RMTYPE == "TYPE 2" | RMTYPE == "TYPE 3" | RMTYPE == "TYPE 4" | RMTYPE == "TYPE 5" ~ "Local",
    RMTYPE == "TYPE 6" ~ "T6",
    RMTYPE == "TYPE 7" ~ "T7",
    RMTYPE == "TYPE 8" ~ "T8",
    RMTYPE == "TYPE 10" ~ "T10",
    RMTYPE == "TYPE 11" ~ "T11",
    TRUE ~ RMTYPE)) |>
  mutate(Source = factor(Source, levels = c("Local", "T6","T7", 
                                        "T8", "T9", "T10", "T11", "TL"))) |>
  ggplot(aes(x=Assemblage, y=`Tool/Blank`, colour = Source)) +
  geom_point(size=3) +
  scale_colour_manual(values = c("#D49B54", "#8B6969", "#CDAF95", "#2B4F60",
                              "#BDD2B6", "#BDC7C9", "#798777"))

```

```{r}
#| label: stats-wilcox

wilcox_t <- phase_dataset |> 
  dplyr::mutate(Prov = case_when(
    RMTYPE == "TYPE 1" | RMTYPE == "TYPE 2" | RMTYPE == "TYPE 3" | RMTYPE == "TYPE 4" | RMTYPE == "TYPE 5" ~ "Local",
    RMTYPE == "TYPE 6" | RMTYPE == "TYPE 7" | RMTYPE == "TYPE 8" | RMTYPE == "TYPE 9" ~ "Non-local",
    TRUE ~ RMTYPE)) |> 
  filter(Prov %in% c("Local", "Non-local")) |> 
  select(ID, CLASS, THICKNESS, MAXWIDTH, LENGTH, WEIGHT, Prov, Level)

wt_blank_proto <- wilcox_t |> 
  filter(Level %in% c("4E", "4E/5")) |> 
  filter(CLASS == "Blank")

dplyr::group_by(wt_blank_proto, Prov) |> 
  summarise(count = n(), median = median(WEIGHT, na.rm = TRUE))
res_blank_proto <- wilcox.test(WEIGHT ~ Prov, data = wt_blank_proto, exact = FALSE)
dplyr::group_by(wt_blank_proto, Prov) |> 
  summarise(count = n(), median = median(LENGTH, na.rm = TRUE))
res_bl_proto <- wilcox.test(LENGTH ~ Prov, data = wt_blank_proto, exact = FALSE)
dplyr::group_by(wt_blank_proto, Prov) |> 
  summarise(count = n(), median = median(MAXWIDTH, na.rm = TRUE))
res_bw_proto <- wilcox.test(MAXWIDTH ~ Prov, data = wt_blank_proto, exact = FALSE)

```


The sizes of lithic artefacts (flakes, elongated blanks, cores and retouched tools) are explored through scatterplots of width and length (@fig-gravettian-boxplots a) and boxplots for weight (@fig-gravettian-boxplots b); complete tables with descriptive statistics can also be found in SOM ++, table s++. The scatterplots show different patterns in the several analysed classes. Flakes are longer and wider in local cherts and generally smaller in non-local types (\~20-22 mm maximum lengths for T6 and T7). This is similar for elongated blanks, with non-local cherts presenting thinner and short bladelets than local types. Core width is variable between both local and non-local cherts; however, non-local cherts show a concentration of cores in the ~20 mm length mark, while local cherts show a wider variation of longer cores. Retouched tools show no differences in width and length between local and non-local cherts. Regarding the weight (@fig-gravettian-boxplots b), although there is some variability, non-local types T6 and T7 seem to have the lowest weights in all classes (flakes, elongated blanks, cores and retouched tools). The lowest means for flakes are for T6 and T7 (\~2.5 gr). However, in general, the lightest flakes seem to be from T2 and T6, although T2 also shows several heavy outliers. Elongated products show even smaller means for T6 and T7 (0.5-1 gr), especially when compared to local cherts (\~2.5 gr). Regarding cores, @tbl-general-gravettian shows that type T2 and T6 have the highest number of cores; between these two types, T6 has the lightest cores, with a maximum of \~21 gr and with a mean of \~12 gr, in comparison to T2 with a maximum of \~37 gr and a mean of \~21 gr. Retouched tools shows similar median values among all chert types (2.5-4 gr), although T6 and T7 have the lowest means (\~4 gr); in general, and given the high number of retouched tools for T6 (@tbl-general-gravettian), this non-local chert seems to have been consistently reduced with a third quartile ending in the 5 gr mark.

```{r}
#| label: fig-gravettian-boxplots
#| fig-cap: Boxplots Gravettian

ggpubr::ggarrange(gravettian_scatter, gravettian_stats_weight, labels = c("a", "b"), ncol = 2, common.legend = TRUE, legend = "bottom")

```

As seen in @fig-ratiotd (see also table s++ in the SOM ++), the lowest ratio of retouched to debitage is seen in T1 and T4, with values below 0.1, while other local types show slightly higher values (0.1-0.2). Following the same trend as the Gravettian, the non-local cherts show slightly higher ratios (0.3-0.5) of retouched to debitage. Regarding the blank to core ratio (@fig-ratiobc and table s++ in the SOM ++), T2 and T4 show the lowest ratios (8.7 and 6.2 respectively) of blanks per cores, while the non-local T7 shows the highest ratios (11.0) of blanks to cores. Unlike the Gravettian, T1 (local chalcedony) and T6 (non-local chert) have no cores (@tbl-general-proto).

Regarding the size (width, length and weight) of lithic artefacts (flakes, elongated blanks, cores and retouched tools), several patterns can be seen between local and non-local chert types (@fig-proto-boxplots, table s++ and s++ in the SOM ++). The distribution of width and length (@fig-proto-boxplots a) for flakes shows a concentration of non-local flakes below the 25 mm width and length (with means around 20 mm), while local cherts are more variable and show larger widths and lengths. Similarly, the larger elongated blanks are from local cherts, although there is variability in the sizes. Although there are clear differences in the number of cores between local and non-local cherts (@tbl-general-proto) making patterns harder to identify, non-local cherts seem to show smaller cores. Finally, regarding retouched tools, non-local cherts also seem to be smaller, with widths concentrated below the 20 mm mark, while local cherts are concentrated above the 20 mm mark; no differences were identified regarding length. As for weight (@fig-proto-boxplots b and table s++ in SOM ++), local flakes seem to be heavier than  non-local cherts (means of 3.5-4.5 gr and 1.3-2.6 gr, respectively); especially T4 shows heavier flakes and outliers, than T6 and T7. In comparison, elongated blanks show no differences between local and non-local cherts. Although non-local chert cores are barely represented in the assemblage (@tbl-general-proto), they show the lighter weights than local cherts. Retouched tools show the clearest differences, with non-local cherts presenting lighter weights than local cherts.

```{r}
#| label: fig-proto-boxplots
#| fig-cap: Boxplots Proto-solutrean.

ggpubr::ggarrange(proto_scatter, proto_stats_weight, labels = c("a", "b"), ncol = 2, common.legend = TRUE, legend = "bottom")

```

Regarding the tools-to-debitage and blank-to-core ratios, the Solutrean assemblage shows similar patterns as the previous assemblages (@fig-ratiotd and @fig-ratiobc, respectively). Local cherts (T2-T5) show low retouch to debitage ratios (\<0.1), with the exception of T1 (chalcedony), which shows a ratio of 1.8. Other non-local cherts (T6-T7 and T11) show slightly higher retouch to debitage ratios (0.1-0.3). Similarly, local cherts show lower blank to core ratios (\<7), while the non-local cherts show higher ratios (\>9). Similar to the Proto-Solutrean, chalcedony cores were also not identified in the studied sample (@tbl-general-solutrean).

Unlike the other assemblages, there seems to be no clear difference in the measurements and weights of artefacts between local and non-local cherts (@fig-solutrean-boxplots and table s++ in SOM ++). The exception are elongated blanks, with show differences between T2 and T6, with T6 showing smaller width and lengths (<35 mm and 15 mm, respectively), than the local type. Similarly, elongated blank weights are smaller in T6 (ranging between 0-5-2 gr). Core weights are also slightly lower in T6 (means of 16.5 gr) than in T2, although the sample is comparatively small (@tbl-general-solutrean).

```{r}
#| label: fig-solutrean-boxplots
#| fig-cap: Boxplots Solutrean.

ggpubr::ggarrange(solutrean_scatter, solutrean_stats_weight, labels = c("a", "b"), ncol = 2, common.legend = TRUE, legend = "bottom")

```

# Discussion

As mentioned before, this study aimed to test two expectations related to the use and knapping of local and non-local raw materials, in specific, chert and chalcedony, and their relation to settlement and mobility strategies, across several UP occupations. As such, our method derived the following hypotheses to test: a) use lives derived from knapping strategies; b) reduction intensity and tools-to-debitage ratios; c) core size and blank-to-core ratios; d) reduction intensity and tool reworking; e) tool typology diversity and specialization (@tbl-expectations).

To test these hypotheses, the following parameters were evaluated for each assemblage and compared between chert types: P1) frequency of retouched tools; P2) frequency of maintenance products; P3) debitage sizes; P4) tools-to-debitage ratios ; P5) core sizes; P6) blank-to-core ratios; P7) retouched tool sizes; P8) tool diversity; P9) tool specialization. These parameters and their main results can be found in table @tbl-results-sum, and can be summarised as follows.

In the Gravettian assemblage, retouched tools (P1) are present in higher frequencies in the non-local cherts, as well as in core preparation and maintenance products (P2). Debitage sizes (P3) show smaller sizes and weights for non-local cherts. Tools-to-debitage ratios (P4) are significantly higher in non-local cherts. Core sizes (P5) are slightly smaller in T6, a non-local chert, and the blank-to-core ratios (P6) are higher in non-local cherts. Retouched sizes (P7) show no relevant differences between local and non-local cherts; however, tool diversity (P8) is higher in non-local cherts, although with high frequency of less specialised tools such as notches and retouched tools, alongside hunting implements such as backed bladelets (P9). The high frequency of burins seen in this assemblage may be related to their use as cores, representing a knapping strategy more than the presence of retouch.

```{r}
#| label: tbl-results-sum
#| tbl-cap: "Summarised results for analysis parameters. Gr: Gravettian; Pr: Proto-Solutrean; So: Solutrean; Exp: Expectations; L: Local; NL: Non-local." 

p_results <- readr::read_csv(here::here('analysis/data/tables/results_sum.csv'))

knitr::kable(head(p_results))

```


The Proto-Solutrean assemblages show a smaller presence of retouched tools than the Gravettian, and within the assemblage, retouched tools (P1) are slightly more frequent in non-local cherts. Core preparation and maintenance products (P2) are only present in non-local cherts, albeit in very small numbers (n=2). Blank sizes (P3), core sizes (P5), and retouched tool sizes (P7) are slightly smaller in non-local cherts. Regarding the ratios, tool-to-debitage ratios (P4) are higher in non-local cherts, albeit smaller than those seen in the Gravettian assemblage, and blank-to-core ratios (P6) are also higher in non-local cherts. Little differences were observed in tool diversity (P8) and specialisation (P9) between local and non-local cherts.

Finally, the Solutrean shows no relevant differences in the frequencies of retouched tools (P1) and core preparation and maintenance products (P2) between local and non-local cherts, with only slightly higher frequencies in the non-local cherts. In general, the retouch frequency is lower than that observed in the previous assemblages. Debitage (P3), core (P5), and retouched tool (P7) sizes show no differences between local and non-local cherts, except for elongated blanks which are smaller in T6 and bigger in T2, and for slightly smaller cores seen in T6, although with high standard deviations. Similarly to the Proto-Solutrean, tools-to-debitage ratios (P4) and blank-to-core ratios (P6) are slightly higher in non-local cherts. Both tool diversity (P8) and tool specialization (P9) are higher in local cherts.

In general, the obtained results seem to fit the study expectations. The Gravettian assemblage seems to show agreement with most of the expectations (table **). Although ~50% of the assemblage is composed of non-local raw materials, making them as frequent as the local cherts, non-local cherts, especially T6 and T7 show differential techno-typological patterns from the local raw materials. Only in expectation e) there seems to be a difference from the expected outcome.

In this sense, it would be expected a lower typological diversity from non-local cherts, since the distance to source and inferred mobility would assume that less specialized tools would be more adequate for several use-case scenarios; instead, our results show higher tool diversity in non-local cherts. However, this scenario also implies that tools are being transported as either less specialized tools or even blanks which are then maintained. Instead, our results also suggest that the long-distance raw materials, especially T6 and T7, are being knapped at the site. As such, the high diversity of tool typology may simply be a reflection of the transportation of volumes and their knapping on site, a possible preference for these raw materials for the production of retouched tools, and thus their high typological variability. Despite this high variability however, less specialized tools such as retouched blanks are still predominant in non-local cherts, as well as specialized tools such as backed bladelets, giving weight to the interpretation that given the possible ease of access to these raw materials, either through high-mobility or exchanged between groups, these were knapped on site, but with longer use-lives, extensive reduction and high presence of retouch and formal tools.

Similarly, the Proto-Solutrean assemblage shows only disagreement with the expected outcomes within the variability of retouched tools (expectation e and P8-9) and possibly the focus on maintenance and prolonging use-lives of tools (expectation a), especially concerning P2. Unlike expected, there are little differences in the amount and type of retouched tool types between local and non-local raw materials. Unlike the Gravettian occupation, however, retouched tools are overall not well-represented in the assemblage. It is key to notice, however, that the Proto-Solutrean occupation of Vale Boi seemed to introduce other raw materials, such as quartz or dolerite, to the production of retouched tools. Although knapping strategies seemed to be overall simpler (e.g., simple platform cores in quartz), splintered pieces are highly represented in quartz. In opposition, most endscrapers are made of chert (Belmiro et al., 2021), while the majority of Vale Comprido points are found in dolerite (Belmiro et al., 2021; Marreiros, 2009). These patterns, then, may correspond to a specialisation of tool production to the type of raw material itself (whether quartz, chert or dolerite), thus making chert, retouched tool variability patterns similar and unrelated to distance of source. Regarding P2, although there is a slightly higher presence of core preparation and maintenance products in non-local cherts, there is an overall lack of this class of artefacts. This means that for the Proto-Solutrean assemblage of Vale Boi, core maintenance variables are not adequate to discern differences between local and non-local raw materials, since these knapping strategies were not consistently used during this chronology.

Finally, the Solutrean assemblages also show only two parameters that disagree with the expectations: debitage sizes (P3) and retouched tool sizes (P7). Flakes show no differences in dimensions and weight between local and non-local raw materials. This may be related to the production process of Solutrean points, which may start with larger flakes or elongated products that are then reconfigured to the desired product, thus producing similar discarded flakes in all chert types. However, elongated blanks do follow the expected patterns, with non-local cherts having smaller products and local cherts. This may mean that non-local cherts, especially T6, are being further reduced in specific strategies for the production of elongated products, thus leading to different patterns between these two classes of blanks. The sizes of retouched tools, alike flakes, also show no relevant differences between local and non-local. However, this variable may not be adequate for the present study, especially regarding the size measurements; both width and length are used for scatterplots, however, the technological database used in this study is missing specific measurements (especially length) for typologies of retouched tools. As such, the scatterplots are further truncated by the difference in analysis methodology, making this pattern possibly invalid.

Aside from the specific expectations for the treatment of local and non-local cherts within each assemblage, when comparing between technocomplexes, a few key patterns also stand out. Chert retouched tools are present in higher percentages in the Gravettian assemblages (~22%) than in the Proto-Solutrean and Solutrean assemblages (<10%). This is also clear through the tool-to-debitage ratios, which are higher in the Gravettian assemblage (@fig-ratiotd).

There are little differences in the general size and weight of the artifacts between assemblages. For example, for key classes where size and weight differences could be expected (e.g., cores), the length measurements are mostly all located between 20-40 mm and weight between 10-40 gr. The major differences seem to be explained better by bigger cores in local chert types and smaller cores for non-local chert types. However, a few key differences were noted. T4 cores (the chert type most frequent in the Proto-Solutrean assemblage) shows the largest weights of cores of all assemblages, both in the Solutrean and Proto-Solutrean assemblage, as well as T5 in the Solutrean assemblage. T6 and T7 have consistently the smaller weights, especially compared to T2 during the Proto-Solutrean and Gravettian, which shows slightly higher weights. This consistency in artefact size throughout the assemblages may be explained by a combination of local lithic resource availability and transport and knapping strategies focusing on intensive reduction and maintenance of non-local raw materials. Belmiro et al. (2023) highlight the small size of chert nodules (usually between ~5-10 cm with a maximum of 20 cm of diameter) in the Algarve region. Although abundant and possibly available throughout all of the UP, given their location in accessible cliffs, these lithic resources are often small and fracture easily when obtained directly from the source. Given the possibly initial small size of the local chert nodules, it may be possible that the small artefact sizes are related not to intensive knapping of the nodules, but to the initial size of the knapped volumes. This is also supported by the lower blank-to-core ratios seen in local raw materials.

In comparison, at least for T6 cherts from central Portugal (for which we have a comparable reference collection of unknapped volumes collected from secondary sources), the initial volumes are frequently larger (>20 cm), although smaller nodules can also be found. This suggests that the small artefact sizes of this non-local resource are not necessarily a product of resource availability but an intentional choice of either transportability of smaller volumes/nodules, knapping strategies focused on intensive reduction and maintenance, or both. This is also supported by the higher blank-to-core and tool-to-debitage ratios seen in non-local raw materials, especially T6.

A key interpretation can be derived. Cores, shatter and debitage are present even in non-local chert types (excluding the TL category), meaning although possibly coming from long-distance (e.g., T6 and T7 with sources over ~200 km, as the crow flies), these raw materials were being introduced to the site as knappable volumes and not only as finished products. This has also been previously suggested, based on the presence of cortex attributed to small transport distances from source to procurement area, in non-local cherts in all assemblages (Belmiro et al., 2025).

## Some extra notes and structure

- Goals of the study
- Parameters studied
- Summary of the results based on expectations
- How they fit within the expectations + how they differ by assemblage
- General differences between expectations
- Interpretation of chert procurement and management, and changes through time + settlement changes

When groups move to areas where raw materials are scarcer or of poorer quality (understanding that poorer quality may not mean they are bad quality, simply not as good quality as the raw materials group have current access), more effort is placed in the preparation of transportable cores and tools (Kelly, 1988). This may be the case for the Gravettian assemblage; not only is the percentage of tools high, large enough volumes of stone were transported to the site and knapped, but also high frequency of burins, which may have also been a technological choice to obtain elongated products in an efficient way. There seems to be an effort in transporting raw materials of known good quality in transportable yet adaptable shapes to later shape and use.

It would be also expected that whenever groups have easy access to good quality, non-local raw materials, either due to high mobility or exchanges between groups, these resources become more abundant in the assemblage, but also be less extensively used (Andrefsky, 1994). The idea is that the patterns of non-local raw material use are based on their conservation due to cost of procurement; when that cost is reduced, so is the necessity to conserve the resources, and thus the expected patterns may not be as clear. Despite the high frequency of non-local raw materials, which implies some sort of ease of access to non-local raw materials of good quality, probably due to high residential mobility, the assemblage still shows conservation of raw materials. This is seen in the high frequence of retouched tools and high ratios of tool to debitage when compared to local raw materials. Artefact sizes are also smaller in non-local raw materials then local raw materials and blank-to-core ratios are higher, showing that these non-local raw materials were extensively used. This shows that access to non-local raw materials, making them highly represented in the assemblage, especially the cherts from central Portugal (T6), did not impact the patterns expected for the treatment of non-local raw materials.

A strategy used to raw material transportation is stockpilling lithic raw materials in various production stages, thus reducing the need for extensive lithic production and tool reworking (Kuhn, 2004). Longer-term residential occupations occupations are more likely to involve stockpilling strategies and reduced investment in tool maintenance (Bamforth, 1990). This would create assemblages with more blanks, less maintenance products and less retouched tools such as retouched flakes. However, even with stockpilling, 



# Conclusion

# Acknowledgements

<!-- The following line inserts a page break  -->

\newpage

# References

<!-- The following line ensures the references appear here for the MS Word or HTML output files, rather than right at the end of the document (this will not work for PDF files):  -->

::: {#refs}
:::

\newpage

### Colophon

This report was generated on `r Sys.time()` using the following computational environment and dependencies:

```{r}
#| label: colophon
#| cache: false

# which R packages and versions?
if ("devtools" %in% installed.packages()) devtools::session_info()
```
